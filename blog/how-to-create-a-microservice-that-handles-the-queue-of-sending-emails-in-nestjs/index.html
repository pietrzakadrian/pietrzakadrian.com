<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.7"/><meta name="description" content="In this article, I will present you independent microservice that handles the queue of sending emails using the Node.js platform with the NestJS framework. The use of this microservice allows you to decouple the business logic of the email senders from the main monolithic application, resulting in less use of server resources and therefore faster source code execution." data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta name="twitter:title" content="How to create a microservice that handles 🎢 the queue of sending emails in NestJS — Adrian Pietrzak: Software Engineering Blog" data-gatsby-head="true"/><meta name="twitter:description" content="In this article, I will present you independent microservice that handles the queue of sending emails using the Node.js platform with the NestJS framework. The use of this microservice allows you to decouple the business logic of the email senders from the main monolithic application, resulting in less use of server resources and therefore faster source code execution." data-gatsby-head="true"/><meta name="og:title" content="How to create a microservice that handles 🎢 the queue of sending emails in NestJS — Adrian Pietrzak: Software Engineering Blog" data-gatsby-head="true"/><meta name="og:type" content="website" data-gatsby-head="true"/><meta name="og:description" content="In this article, I will present you independent microservice that handles the queue of sending emails using the Node.js platform with the NestJS framework. The use of this microservice allows you to decouple the business logic of the email senders from the main monolithic application, resulting in less use of server resources and therefore faster source code execution." data-gatsby-head="true"/><meta name="image" content="https://pietrzakadrian.com/static/5d7467fd82762ea414353f94589606ed/thumbnail.jpeg" data-gatsby-head="true"/><meta name="og:image" content="https://pietrzakadrian.com/static/5d7467fd82762ea414353f94589606ed/thumbnail.jpeg" data-gatsby-head="true"/><meta name="twitter:image" content="https://pietrzakadrian.com/static/5d7467fd82762ea414353f94589606ed/thumbnail.jpeg" data-gatsby-head="true"/><meta name="theme-color" content="hsl(31, 92%, 62%)"/><style data-href="/styles.f24ed58f90d07f261622.css" data-identity="gatsby-global-css">:after,:before,:root{--color-white:#fff;--color-primary:#2c964a;--color-secondary:#2ea34f;--color-prism-background:#e2e5e9;--color-typographic-base-font:#242933;--color-typographic-link-p-font:#2ea34f;--color-typographic-link-s-font:#2c964a;--color-page-border:#e2e5e9;--color-page-background:#fff;--color-sidebar-border:#e2e5e9;--color-sidebar-border-fade:#fff;--color-contacts-border:#e2e5e9;--color-button-border:#e2e5e9;--color-button-color:#242933;--color-theme-switcher:#3f485a;--color-theme-switcher-hover:#2c964a;--color-tag-silver:#f5f7fa;--color-tag-silver-hover:#e6e6e6;--color-tag-silver-text:#242933;--color-input-border:#e2e5e9}.dark :after,.dark :before,:root.dark{--color-white:#fff;--color-primary:#548fc9;--color-secondary:#4082c4;--color-prism-background:#13161b;--color-typographic-base-font:#fff;--color-typographic-link-p-font:#4082c4;--color-typographic-link-s-font:#548fc9;--color-page-border:#3f485a;--color-page-background:#242933;--color-sidebar-border:#3f485a;--color-sidebar-border-fade:#242933;--color-contacts-border:#3f485a;--color-button-border:#3f485a;--color-button-color:#fff;--color-theme-switcher:#e2e5e9;--color-theme-switcher-hover:#4082c4;--color-tag-silver:#13161b;--color-tag-silver-hover:#3f485a;--color-tag-silver-text:#fff;--color-input-border:#13161b}html{font-size:100}body,html{overscroll-behavior-y:none}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;background:var(--color-page-background);color:var(--color-typographic-base-font);font-family:Gotham-Book,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif;font-size:16px;line-height:1.625;margin:0 0 0 calc(100vw - 100%);text-rendering:optimizelegibility}h1,h2,h3,h4,h5,h6{font-family:Butler,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1{font-size:40px;line-height:52px;margin-bottom:26px;margin-top:104px}h2{font-size:27px;line-height:39px}h2,h3{margin-bottom:13px;margin-top:52px}h3{font-size:22px;line-height:26px}h4{font-size:19.2px;margin-top:39px}h4,h5{line-height:26px;margin-bottom:13px}h5,h6{font-size:16px;margin-top:65px}h6{line-height:26px;margin-bottom:13px}img{max-width:100%}hr,img{border:0;display:block}hr{margin:20px auto;text-align:center;width:100px}hr,hr:before{color:var(--color-typographic-base-font)}hr:before{content:"⦁  ⦁  ⦁";font-size:15px}a{color:var(--color-typographic-link-p-font);text-decoration:none}a:active,a:focus,a:hover{color:var(--color-typographic-link-s-font)}b,strong{font-weight:600}ul{list-style:square;margin-bottom:26px}ul li{margin-bottom:10px;padding:0 5px}p{line-height:26px;margin-bottom:26px}blockquote{box-shadow:inset 3px 0 0 0 var(--color-typographic-base-font);font-style:italic;margin-left:0;padding-left:26px;text-align:left}figure{display:block;height:auto;width:100%}figcaption{color:var(--color-typographic-base-font);font-size:14px;font-style:italic;line-height:19.5px;margin-bottom:0;margin-top:6.5px;text-align:center}button{background-color:transparent}button,input{border-width:0;font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;line-height:inherit;padding:0}input:focus{outline:none}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:310px;padding:0 26px}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Fira Code,Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:14px;-webkit-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2e3440}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#636f88}.token.punctuation{color:#81a1c1}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#81a1c1}.token.number{color:#b48ead}.token.boolean{color:#81a1c1}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a3be8c}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#81a1c1}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#88c0d0}.token.keyword{color:#81a1c1}.token.important,.token.regex{color:#ebcb8b}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@font-face{font-display:swap;font-family:Gotham-Book;font-style:normal;font-weight:400;src:local("Gotham-Book"),url(/static/Gotham-Book-207b1f58e0df329a118662e5e3d7500b.eot?#iefix) format("embedded-opentype"),url(/static/Gotham-Book-b39f02e9da64e0412f2091961423b8a3.woff2) format("woff2"),url(/static/Gotham-Book-e872be4db2fd5c800fd8d1b9d0372fc9.woff) format("woff"),url(/static/Gotham-Book-4c2cf6d6bc07b328e8d00fc4b8c70ff9.ttf) format("truetype"),url(/static/Gotham-Book-827308a1a798e3fe077d466f9c1ad461.svg#Gotham-Book) format("svg")}@font-face{font-display:swap;font-family:Butler;font-style:normal;font-weight:400;src:local("Butler"),url(/static/Butler-4a42f1a5ba360aad73c4e68c45a9d538.eot?#iefix) format("embedded-opentype"),url(/static/Butler-99c7b1a6053c62da9427902eaab58690.woff2) format("woff2"),url(/static/Butler-7704cc6b567d92ede0f67d6060f8f5c3.woff) format("woff"),url(/static/Butler-86d94a8a10eba000cff7120d06fe9312.ttf) format("truetype"),url(/static/Butler-0b1942017c6ffdc0d629c82f0a6d2077.svg#Butler) format("svg")}.Collaboration-module--collaboration--77306 .Collaboration-module--button--1a15e{line-height:1;min-height:50px}.Button-module--button--b1113,.Button-module--link--ce317{display:flex;justify-content:center}.Button-module--button--b1113{align-items:center;background-color:var(--color-secondary);color:var(--color-white);font-weight:600;padding:10px 15px;text-align:center;transition:background-color .2s ease}.Button-module--button--b1113:hover{background-color:var(--color-primary);color:#fff;cursor:pointer}.Tags-module--tags--18589{margin-bottom:13px}.Tags-module--tags--18589 .Tags-module--list--82ae6{list-style:none;margin-top:0;padding:0}.Tags-module--tags--18589 .Tags-module--list--82ae6 .Tags-module--item--52015{display:inline-block;margin:6.5px 0;padding:0 6.5px 0 0}@media screen and (min-width:685px){.Tags-module--tags--18589 .Tags-module--list--82ae6 .Tags-module--item--52015:first-child{margin-left:0;padding-left:0}}.Tags-module--tags--18589 .Tags-module--list--82ae6 .Tags-module--item--52015 .Tags-module--button--421f7{align-items:center;background-color:var(--color-tag-silver);border:none;border-radius:20px;color:var(--color-tag-silver-text);display:flex;font-size:12px;height:26px;line-height:0;padding:0 13px;text-decoration:none;transition:background .1s ease}.Tags-module--tags--18589 .Tags-module--list--82ae6 .Tags-module--item--52015 .Tags-module--button--421f7:hover{background-color:var(--color-tag-silver-hover)}.Layout-module--layout--2c933{margin-left:auto;margin-right:auto;max-width:1070px}.Layout-module--layout--2c933:before{content:"";display:table}.Layout-module--layout--2c933:after{clear:both;content:"";display:table}.Feed-module--feed--a6204 .Feed-module--item--c7a63{margin-bottom:32.5px}.Feed-module--feed--a6204 .Feed-module--item--c7a63:last-child{margin-bottom:13px}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--title--f252f{font-size:27px;line-height:39px;margin-bottom:3.9px;margin-top:0}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--title--f252f .Feed-module--link--6123b{color:var(--color-typographic-base-font)}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--title--f252f .Feed-module--link--6123b:focus,.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--title--f252f .Feed-module--link--6123b:hover{border-bottom:1px solid var(--color-typographic-base-font);color:var(--color-typographic-base-font)}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--description--57348{-webkit-box-orient:vertical;-webkit-line-clamp:4;display:-webkit-box;font-size:16px;line-height:26px;margin-bottom:19.5px;margin-top:0;overflow:hidden}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--bottom--dd480{align-items:center;display:flex}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--bottom--dd480 small{align-items:center;color:#7f8ba4;display:flex;height:26px;white-space:nowrap}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--bottom--dd480 .Feed-module--tags--75a26 div,.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--bottom--dd480 .Feed-module--tags--75a26 li,.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--bottom--dd480 .Feed-module--tags--75a26 ul{margin:0}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--time--72864{color:#7f8ba4;font-size:14px;font-weight:600}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--divider--81a18{color:#7f8ba4;margin:0 6.5px}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 small{color:#7f8ba4;font-size:14px;font-weight:600}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--category--59f58 .Feed-module--link--6123b{color:var(--color-secondary);font-size:14px;font-weight:600;text-transform:uppercase}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--category--59f58 .Feed-module--link--6123b:focus,.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--category--59f58 .Feed-module--link--6123b:hover{color:#4082c4}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--more--51a4e{color:var(--color-primary);font-size:16px}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--more--51a4e:focus,.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--more--51a4e:hover{border-bottom:1px solid var(--color-primary);color:var(--color-primary)}.Page-module--page--24e03{margin-bottom:52px}.Page-module--page--24e03 .Page-module--inner--4b31d{padding:26px 19.5px 0}.Page-module--page--24e03 a{font-weight:600}.Page-module--page--24e03 .Page-module--title--90338{font-size:40px;font-weight:600;line-height:52px;margin-bottom:37.7px;margin-top:0}.Page-module--page--24e03 .Page-module--body--561c4{font-size:16px;line-height:26px;margin:0 0 26px}.Page-module--page--24e03 .Page-module--body--561c4 p{text-align:justify}@media screen and (min-width:685px){.Page-module--page--24e03{width:calc(58.275% - 12.5px)}.Page-module--page--24e03:nth-child(1n){clear:none;float:left;margin-right:30px}.Page-module--page--24e03:last-child{margin-right:0}.Page-module--page--24e03:nth-child(12n){float:right;margin-right:0}.Page-module--page--24e03:nth-child(12n+1){clear:both}.Page-module--page--24e03 .Page-module--inner--4b31d{padding:32.5px 19.5px 0}}@media screen and (min-width:960px){.Page-module--page--24e03{width:calc(66.6% - 10px)}.Page-module--page--24e03:nth-child(1n){clear:none;float:left;margin-right:30px}.Page-module--page--24e03:last-child{margin-right:0}.Page-module--page--24e03:nth-child(3n){float:right;margin-right:0}.Page-module--page--24e03:nth-child(3n+1){clear:both}.Page-module--page--24e03 .Page-module--inner--4b31d{padding:39px 26px 0}}.Pagination-module--pagination--d61cb{display:flex;margin-top:52px}.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b{text-align:left;width:50%}.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b .Pagination-module--previousLink--5590d{color:var(--color-secondary);font-size:26px;font-weight:700}.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b .Pagination-module--previousLink--5590d:focus,.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b .Pagination-module--previousLink--5590d:hover{color:var(--color-primary)}.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b .Pagination-module--previousLink--5590d.Pagination-module--disable--7e105{color:#3f485a;pointer-events:none}.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8{text-align:right;width:50%}.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8 .Pagination-module--nextLink--532ff{color:var(--color-secondary);font-size:26px;font-weight:700}.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8 .Pagination-module--nextLink--532ff:focus,.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8 .Pagination-module--nextLink--532ff:hover{color:var(--color-primary)}.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8 .Pagination-module--nextLink--532ff.Pagination-module--disable--7e105{color:#3f485a;pointer-events:none}.Related-module--related--75a7f .Related-module--header--4fb3a{margin-top:0}.Meta-module--meta--dae0a{color:#7f8ba4;display:flex;font-size:14px;font-weight:600}.Meta-module--meta--dae0a p{margin:0}.Meta-module--meta--dae0a span{margin:0 6px}.ThemeSwitcher-module--themeSwitcher--8a77f{--color:var(--color-theme-switcher)}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--button--7cb7b{align-items:center;background:transparent;border:0;cursor:pointer;display:flex;justify-content:center;outline:0}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--button--7cb7b svg{stroke:var(--color);pointer-events:none;transition:stroke .4s}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--button--7cb7b:hover{--color:var(--color-theme-switcher-hover)}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--moon--10537{stroke-dasharray:0 1px;opacity:0;transition:stroke-dasharray .2s ease-in,opacity .4s ease-in}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--sun--2163a{stroke-dasharray:1px 1px;opacity:1;transition:stroke-dasharray .2s ease-in,opacity .4s ease-in}.ThemeSwitcher-module--themeSwitcher--8a77f.ThemeSwitcher-module--dark--6db0c .ThemeSwitcher-module--moon--10537{stroke-dasharray:1px 1px;opacity:1}.ThemeSwitcher-module--themeSwitcher--8a77f.ThemeSwitcher-module--dark--6db0c .ThemeSwitcher-module--sun--2163a{stroke-dasharray:0 1px;opacity:0}.Author-module--author--1c58d{align-items:center;display:flex;justify-content:space-between;line-height:26px;margin-bottom:39px;margin-top:13px;max-width:640px}.Author-module--author--1c58d .Author-module--photo--b037c{background-clip:padding-box;border-radius:50%;display:inline-block;height:50px;margin-bottom:0;margin-right:13px;width:50px}.Author-module--author--1c58d .Author-module--photo--b037c img{border-radius:50%}.Author-module--author--1c58d p,.Author-module--author--1c58d span,.Author-module--author--1c58d strong{line-height:1}.Author-module--author--1c58d .Author-module--information--20ba9{align-items:center;display:flex}.Author-module--author--1c58d .Author-module--information--20ba9 .Author-module--wrapper--5b181{display:flex;flex-direction:column;gap:5px}@media screen and (min-width:685px){.Author-module--author--1c58d{margin-left:auto;margin-right:auto}}.Content-module--content--80d58{margin:0 auto;max-width:945px;padding:0}.Content-module--content--80d58 .Content-module--title--09504{font-size:32px;font-weight:600;line-height:42.9px;margin:0 auto;max-width:640px;text-align:left}.Content-module--content--80d58 h1{font-size:28.8px;margin-top:26px}.Content-module--content--80d58 h2{font-size:24px}.Content-module--content--80d58 .Content-module--body--726c2{text-align:justify}.Content-module--content--80d58 .Content-module--body--726c2 figure{margin-bottom:26px}.Content-module--content--80d58 .Content-module--body--726c2 figure blockquote{font-style:italic;margin-top:0;padding:26px 0}.Content-module--content--80d58 .Content-module--body--726c2 figure blockquote p{font-size:26.9072px;line-height:39px;margin-bottom:26px;margin-top:0;max-width:640px}.Content-module--content--80d58 .Content-module--body--726c2 a{text-decoration:underline}.Content-module--content--80d58 .Content-module--body--726c2 *{margin-left:auto;margin-right:auto;max-width:640px}.Content-module--content--80d58 .Content-module--body--726c2 h2>a{visibility:hidden}.Content-module--content--80d58 .Content-module--body--726c2 h2>a>svg{fill:var(--color-typographic-base-font)}.Content-module--content--80d58 .Content-module--body--726c2 img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--80d58{padding:0}.Content-module--content--80d58 .Content-module--title--09504{font-size:48px;line-height:58.5px;margin-bottom:0;margin-top:0}.Content-module--content--80d58 .Content-module--body--726c2,.Content-module--content--80d58 .Content-module--body--726c2 p{font-size:18px;line-height:29.25px;margin-bottom:29.25px}.Content-module--content--80d58 .Content-module--body--726c2 h2>a{padding-right:13px;visibility:unset}}.Copyright-module--copyright--766ee{color:#7f8ba4;font-size:14px}.Post-module--post--3a994 .Post-module--content--3c6e5{margin:0 auto}.Post-module--post--3a994 .Post-module--footer--f8705{margin:0;max-width:640px;padding:0}.Post-module--post--3a994 .Post-module--comments--d3b99{margin:0 auto;max-width:640px;padding:0!important}@media screen and (min-width:960px){.Post-module--post--3a994 .Post-module--footer--f8705{padding:0}}.Author-module--author--cbd31 .Author-module--photo--9787b{background-clip:padding-box;border-radius:50%;display:inline-block;height:75px;margin-bottom:0;width:75px}.Author-module--author--cbd31 .Author-module--photo--9787b img{border-radius:50%}.Author-module--author--cbd31 .Author-module--title--cf7e5{font-family:Gotham-Book,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif;font-size:18px;font-weight:600;line-height:29.25px;margin:0}.Author-module--author--cbd31 .Author-module--title--cf7e5 .Author-module--link--09c17,.Author-module--author--cbd31 .Author-module--title--cf7e5 .Author-module--link--09c17:focus,.Author-module--author--cbd31 .Author-module--title--cf7e5 .Author-module--link--09c17:hover{color:var(--color-typographic-base-font)}.Author-module--author--cbd31 .Author-module--subtitle--86ec5{color:#7f8ba4;line-height:26px;margin-bottom:26px}.Author-module--author--cbd31 .Author-module--titleContainer--4f576{align-items:center;display:flex;justify-content:space-between;margin:13px 0}.Icon-module--icon--1d7da{fill:currentcolor;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;speak:none;stroke:currentcolor;stroke-width:0;display:inline-block;font-style:normal;font-variant:normal;font-weight:400;height:1.5em;line-height:1em;text-align:center;text-transform:none;width:1.5em}.Contacts-module--contacts--09178{margin-bottom:26px}.Contacts-module--contacts--09178 .Contacts-module--list--9670b{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;margin:0;max-width:150px;padding:0}.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0{align-content:center;align-items:center;display:flex;height:40px;justify-content:center;line-height:40px;margin:9.1px;padding:0;text-align:center}.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0:nth-child(3n+1){margin-left:0}.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0 .Contacts-module--link--de1e0{border:0;color:var(--color-typographic-base-font);cursor:pointer;display:flex;transition:color .2s ease}.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0 .Contacts-module--link--de1e0:focus,.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0 .Contacts-module--link--de1e0:hover{color:var(--color-typographic-link-p-font)}.Menu-module--menu--113a9{margin-bottom:26px}.Menu-module--menu--113a9 .Menu-module--list--e1ae3{list-style:none;margin:0;padding:0}.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679{margin:13px 0;padding:0}.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679 .Menu-module--link--a6f02{border:0;color:var(--color-typographic-base-font);font-size:16px;font-weight:400}.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679 .Menu-module--link--a6f02:focus,.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679 .Menu-module--link--a6f02:hover{border-bottom:1px solid var(--color-primary);color:var(--color-primary)}.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679 .Menu-module--link--a6f02.Menu-module--active--6cb74{border-bottom:1px solid var(--color-typographic-base-font);color:var(--color-typographic-base-font);font-weight:600}.Sidebar-module--sidebar--1bfa1{position:-webkit-sticky;position:sticky;width:100%}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0{padding:26px 19.5px 0;position:relative}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0:after{background:var(--color-sidebar-border);background:linear-gradient(to bottom,var(--color-sidebar-border) 0,var(--color-sidebar-border) 48%,var(--color-sidebar-border-fade) 100%)}@media screen and (min-width:685px){.Sidebar-module--sidebar--1bfa1{top:0;width:calc(41.625% - 17.5px)}.Sidebar-module--sidebar--1bfa1:nth-child(1n){clear:none;float:left;margin-right:30px}.Sidebar-module--sidebar--1bfa1:last-child{margin-right:0}.Sidebar-module--sidebar--1bfa1:nth-child(12n){float:right;margin-right:0}.Sidebar-module--sidebar--1bfa1:nth-child(12n+1){clear:both}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0{padding:32.5px 19.5px 0}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0:after{bottom:0;content:"";height:540px;position:absolute;right:-10px;top:30px;width:1px}}@media screen and (min-width:960px){.Sidebar-module--sidebar--1bfa1{width:calc(33.3% - 20px)}.Sidebar-module--sidebar--1bfa1:nth-child(1n){clear:none;float:left;margin-right:30px}.Sidebar-module--sidebar--1bfa1:last-child{margin-right:0}.Sidebar-module--sidebar--1bfa1:nth-child(3n){float:right;margin-right:0}.Sidebar-module--sidebar--1bfa1:nth-child(3n+1){clear:both}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0{padding:39px}}</style><title data-gatsby-head="true">How to create a microservice that handles 🎢 the queue of sending emails in NestJS — Adrian Pietrzak: Software Engineering Blog</title><link rel="alternate" type="application/rss+xml" title="Adrian Pietrzak" href="/blog/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-205649365-1"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-205649365-1', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=ca508c0e58dd48582015613d9e761dd4" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=ca508c0e58dd48582015613d9e761dd4"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=ca508c0e58dd48582015613d9e761dd4"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=ca508c0e58dd48582015613d9e761dd4"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=ca508c0e58dd48582015613d9e761dd4"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=ca508c0e58dd48582015613d9e761dd4"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=ca508c0e58dd48582015613d9e761dd4"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=ca508c0e58dd48582015613d9e761dd4"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=ca508c0e58dd48582015613d9e761dd4"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script></head><body><script>
          void function() {
            var cachedMode;

            try {
              var preferredTheme = JSON.parse(localStorage.getItem('diesel:theme-atom'));

              if (preferredTheme && preferredTheme.mode) {
                cachedMode = preferredTheme.mode;
              }
            } catch (err) { }

            function setTheme(newTheme) {
              document.documentElement.className = newTheme;
            }

            var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

            setTheme(cachedMode || (darkQuery.matches ? 'dark' : 'light'));
          }()
        </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--2c933"><div class="Sidebar-module--sidebar--1bfa1"><div class="Sidebar-module--inner--344d0"><div class="Author-module--author--cbd31"><a href="/blog"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained Author-module--photo--9787b"><div style="max-width:830px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;850&#x27; width=&#x27;830&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#b8c8d8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/avif" data-srcset="/static/ca508c0e58dd48582015613d9e761dd4/cb27f/photo.avif 208w,/static/ca508c0e58dd48582015613d9e761dd4/0ead2/photo.avif 415w,/static/ca508c0e58dd48582015613d9e761dd4/586a5/photo.avif 830w" sizes="(min-width: 830px) 830px, 100vw"/><source type="image/webp" data-srcset="/static/ca508c0e58dd48582015613d9e761dd4/8cd73/photo.webp 208w,/static/ca508c0e58dd48582015613d9e761dd4/05dd1/photo.webp 415w,/static/ca508c0e58dd48582015613d9e761dd4/ed770/photo.webp 830w" sizes="(min-width: 830px) 830px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 830px) 830px, 100vw" decoding="async" loading="lazy" data-src="/static/ca508c0e58dd48582015613d9e761dd4/e6582/photo.jpg" data-srcset="/static/ca508c0e58dd48582015613d9e761dd4/b1ef2/photo.jpg 208w,/static/ca508c0e58dd48582015613d9e761dd4/0dba3/photo.jpg 415w,/static/ca508c0e58dd48582015613d9e761dd4/e6582/photo.jpg 830w" alt="Adrian Pietrzak"/></picture><noscript><picture><source type="image/avif" srcSet="/static/ca508c0e58dd48582015613d9e761dd4/cb27f/photo.avif 208w,/static/ca508c0e58dd48582015613d9e761dd4/0ead2/photo.avif 415w,/static/ca508c0e58dd48582015613d9e761dd4/586a5/photo.avif 830w" sizes="(min-width: 830px) 830px, 100vw"/><source type="image/webp" srcSet="/static/ca508c0e58dd48582015613d9e761dd4/8cd73/photo.webp 208w,/static/ca508c0e58dd48582015613d9e761dd4/05dd1/photo.webp 415w,/static/ca508c0e58dd48582015613d9e761dd4/ed770/photo.webp 830w" sizes="(min-width: 830px) 830px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 830px) 830px, 100vw" decoding="async" loading="lazy" src="/static/ca508c0e58dd48582015613d9e761dd4/e6582/photo.jpg" srcSet="/static/ca508c0e58dd48582015613d9e761dd4/b1ef2/photo.jpg 208w,/static/ca508c0e58dd48582015613d9e761dd4/0dba3/photo.jpg 415w,/static/ca508c0e58dd48582015613d9e761dd4/e6582/photo.jpg 830w" alt="Adrian Pietrzak"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a><div class="Author-module--titleContainer--4f576"><h2 class="Author-module--title--cf7e5"><a class="Author-module--link--09c17" href="/blog">Adrian Pietrzak</a></h2></div><p class="Author-module--subtitle--86ec5">Software Engineer from Poland. Mostly TypeScript — both frontend &amp; backend side.</p></div><nav class="Menu-module--menu--113a9"><ul class="Menu-module--list--e1ae3"><li class="Menu-module--item--8b679"><a class="Menu-module--link--a6f02" href="/blog">Articles</a></li><li class="Menu-module--item--8b679"><a class="Menu-module--link--a6f02" href="/portrait">Portrait</a></li><li class="Menu-module--item--8b679"><a class="Menu-module--link--a6f02" href="/tools">Tools</a></li><li class="Menu-module--item--8b679"><a class="Menu-module--link--a6f02" href="/certifications">Certifications</a></li><li class="Menu-module--item--8b679"><a class="Menu-module--link--a6f02" href="/collaboration">Collaboration ✨</a></li><li class="Menu-module--item--8b679"><a class="Menu-module--link--a6f02" href="/privacy-policy">Privacy policy</a></li></ul></nav><div class="Contacts-module--contacts--09178"><ul class="Contacts-module--list--9670b"><li class="Contacts-module--item--f9cb0"><a class="Contacts-module--link--de1e0" href="https://github.com/pietrzakadrian" target="_blank" rel="noopener noreferrer"><svg class="Icon-module--icon--1d7da" viewBox="0 0 24 24"><title>github</title><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li><li class="Contacts-module--item--f9cb0"><a class="Contacts-module--link--de1e0" href="https://www.twitter.com/pietrzakadrian" target="_blank" rel="noopener noreferrer"><svg class="Icon-module--icon--1d7da" viewBox="0 0 24 24"><title>twitter</title><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"></path></svg></a></li></ul></div></div></div><div class="Page-module--page--24e03"><div class="Page-module--inner--4b31d"><div class="Page-module--body--561c4"><div class="Post-module--post--3a994"><div class="Post-module--content--3c6e5"><div class="Content-module--content--80d58"><h1 class="Content-module--title--09504">How to create a microservice that handles 🎢 the queue of sending emails in NestJS</h1><div class="Author-module--author--1c58d"><div class="Author-module--information--20ba9"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained Author-module--photo--b037c"><div style="max-width:830px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;850&#x27; width=&#x27;830&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#b8c8d8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/avif" data-srcset="/static/ca508c0e58dd48582015613d9e761dd4/cb27f/photo.avif 208w,/static/ca508c0e58dd48582015613d9e761dd4/0ead2/photo.avif 415w,/static/ca508c0e58dd48582015613d9e761dd4/586a5/photo.avif 830w" sizes="(min-width: 830px) 830px, 100vw"/><source type="image/webp" data-srcset="/static/ca508c0e58dd48582015613d9e761dd4/8cd73/photo.webp 208w,/static/ca508c0e58dd48582015613d9e761dd4/05dd1/photo.webp 415w,/static/ca508c0e58dd48582015613d9e761dd4/ed770/photo.webp 830w" sizes="(min-width: 830px) 830px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 830px) 830px, 100vw" decoding="async" loading="lazy" data-src="/static/ca508c0e58dd48582015613d9e761dd4/e6582/photo.jpg" data-srcset="/static/ca508c0e58dd48582015613d9e761dd4/b1ef2/photo.jpg 208w,/static/ca508c0e58dd48582015613d9e761dd4/0dba3/photo.jpg 415w,/static/ca508c0e58dd48582015613d9e761dd4/e6582/photo.jpg 830w" alt="Adrian Pietrzak"/></picture><noscript><picture><source type="image/avif" srcSet="/static/ca508c0e58dd48582015613d9e761dd4/cb27f/photo.avif 208w,/static/ca508c0e58dd48582015613d9e761dd4/0ead2/photo.avif 415w,/static/ca508c0e58dd48582015613d9e761dd4/586a5/photo.avif 830w" sizes="(min-width: 830px) 830px, 100vw"/><source type="image/webp" srcSet="/static/ca508c0e58dd48582015613d9e761dd4/8cd73/photo.webp 208w,/static/ca508c0e58dd48582015613d9e761dd4/05dd1/photo.webp 415w,/static/ca508c0e58dd48582015613d9e761dd4/ed770/photo.webp 830w" sizes="(min-width: 830px) 830px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 830px) 830px, 100vw" decoding="async" loading="lazy" src="/static/ca508c0e58dd48582015613d9e761dd4/e6582/photo.jpg" srcSet="/static/ca508c0e58dd48582015613d9e761dd4/b1ef2/photo.jpg 208w,/static/ca508c0e58dd48582015613d9e761dd4/0dba3/photo.jpg 415w,/static/ca508c0e58dd48582015613d9e761dd4/e6582/photo.jpg 830w" alt="Adrian Pietrzak"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><div class="Author-module--wrapper--5b181"><strong>Adrian Pietrzak</strong><div class="Meta-module--meta--dae0a"><p>Dec 1, 2021</p><span>—</span><p>11<!-- --> min read</p></div></div></div></div><div class="Content-module--body--726c2"><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/5d7467fd82762ea414353f94589606ed/e5166/thumbnail.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 52.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAAB1m3mEjhP/8QAGRAAAwADAAAAAAAAAAAAAAAAAAERAhAS/9oACAEBAAEFArkVnbEpv//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPwFlf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAAIDAAAAAAAAAAAAAAAAAAIQIDJB/9oACAEBAAY/AtVCh//EABkQAQEAAwEAAAAAAAAAAAAAAAERABAhMf/aAAgBAQABPyHAj2Unk7dUAA3/AP/aAAwDAQACAAMAAAAQX9//xAAXEQADAQAAAAAAAAAAAAAAAAAAARFh/9oACAEDAQE/EGqaH//EABcRAAMBAAAAAAAAAAAAAAAAAAABEVH/2gAIAQIBAT8QRVh//8QAHRABAAIBBQEAAAAAAAAAAAAAAREhABAxUZHR8f/aAAgBAQABPxCLdhPDOVOHc2ds+Ce4fKAQWuv/2Q=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/5d7467fd82762ea414353f94589606ed/8ac56/thumbnail.webp 240w,
/static/5d7467fd82762ea414353f94589606ed/d3be9/thumbnail.webp 480w,
/static/5d7467fd82762ea414353f94589606ed/e46b2/thumbnail.webp 960w,
/static/5d7467fd82762ea414353f94589606ed/92f8c/thumbnail.webp 1200w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/5d7467fd82762ea414353f94589606ed/09b79/thumbnail.jpg 240w,
/static/5d7467fd82762ea414353f94589606ed/7cc5e/thumbnail.jpg 480w,
/static/5d7467fd82762ea414353f94589606ed/6a068/thumbnail.jpg 960w,
/static/5d7467fd82762ea414353f94589606ed/e5166/thumbnail.jpg 1200w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/jpeg"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/5d7467fd82762ea414353f94589606ed/6a068/thumbnail.jpg"
            alt="Thumbnail"
            title="Thumbnail"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>In this article, I will present you independent microservice that handles the queue of sending emails using the Node.js platform with the NestJS framework.</p>
<p>The use of this microservice allows you to decouple the business logic of the email senders from the main monolithic application, resulting in less use of server resources and therefore faster source code execution.</p>
<blockquote>
<p><strong>Note</strong>: As usual, I have prepared a ready-made repository for you with code from this article.<br>
You can find it <a href="https://github.com/pietrzakadrian/nestjs-mailer-microservice" target="_blank" rel="nofollow noopener noreferrer">here</a>.</p>
</blockquote>
<blockquote>
<p><strong>Note</strong>: This article is an expanded version of <a href="https://firxworx.com/blog/coding/nodejs/email-module-for-nestjs-with-bull-queue-and-the-nest-mailer/" target="_blank" rel="nofollow noopener noreferrer">this post</a>. It contains better described source code and microservice implementations.</p>
</blockquote>
<hr>
<h2 id="architecture-of-microservice" style="position:relative;"><a href="#architecture-of-microservice" aria-label="architecture of microservice permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Architecture of microservice</h2>
<p>I have tried to keep this software as simple as possible. Below is the directory structure:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">.
├── app
│   └── index.ts
├── mail
│   ├── constants
│   │   ├── mail.constant.ts
│   │   └── index.ts
│   ├── controllers
│   │   ├── mail.controller.ts
│   │   └── index.ts
│   ├── processors
│   │   ├── mail.processor.ts
│   │   └── index.ts
│   ├── services
│   │   ├── mail.service.ts
│   │   └── index.ts
│   ├── templates
│   │   └── registration.hbs
│   ├── tests
│   │   ├── mail.controller.spec.ts
│   │   └── mail.service.spec.ts
│   └── index.ts
└── main.ts</code></pre></div>
<p>As you can see, there are only a few files and I will guide you through each one.</p>
<hr>
<h2 id="1-installation-and-configuration-of-project-files" style="position:relative;"><a href="#1-installation-and-configuration-of-project-files" aria-label="1 installation and configuration of project files permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Installation and configuration of project files</h2>
<p>According to the <a href="https://docs.nestjs.com/microservices/basics" target="_blank" rel="nofollow noopener noreferrer">official NestJS documentation</a>, to create a microservice you need to install the <code class="language-text">@nestjs/microservices</code> module in the <a href="https://docs.nestjs.com/#installation" target="_blank" rel="nofollow noopener noreferrer">NestJS starter application</a>.</p>
<p>This version of the software is more professional, so we’ll install a bit more of them.<br>
Execute these two lines of code in your terminal while in the root directory of the project.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">yarn add @nestjs/microservices @nestjs/bull @nestjs-modules/mailer @hapi/joi bull handlebars nodemailer @nestjs/config</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">yarn add @types/bull @types/hapi__joi @types/nodemailer --dev</code></pre></div>
<p>You will be using the handlebars template engine, which uses the <strong>.hbs</strong> file format. NestJS needs to know this because by default it only compiles files containing TypeScript code.</p>
<p>Edit the <strong>nest-cli.json</strong> file, which is located in the root directory of the project.</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"collection"</span><span class="token operator">:</span> <span class="token string">"@nestjs/schematics"</span><span class="token punctuation">,</span>
  <span class="token property">"sourceRoot"</span><span class="token operator">:</span> <span class="token string">"src"</span><span class="token punctuation">,</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"assets"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"mail/templates/**/*"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<blockquote>
<p><strong>Note</strong>: You will need redis installed on your server to support the queue. The configuration of this database is simple. Installing it goes beyond the topic of this article. Consult the documentation on the <a href="https://redis.io/" target="_blank" rel="nofollow noopener noreferrer">official redis website</a>.</p>
</blockquote>
<hr>
<h2 id="2-environment-variables" style="position:relative;"><a href="#2-environment-variables" aria-label="2 environment variables permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. Environment variables</h2>
<p>It’s time to create the first file. So let’s start by configuring the environment variables. Create an <strong>.env</strong> file in the root directory of your project:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># Email Settings
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=465
EMAIL_ADDRESS=mailer-microservice@gmail.com
EMAIL_PASSWORD=P4ssw0rd!$

# Redis Settings
REDIS_HOST=localhost
REDIS_PORT=6379</code></pre></div>
<blockquote>
<p><strong>Note</strong>: If you want to use gmail to send emails, remember to <a href="https://myaccount.google.com/lesssecureapps" target="_blank" rel="nofollow noopener noreferrer">enable access to less secure applications</a>.</p>
</blockquote>
<p>Now we link the environment variables to the main module, which is located in <strong>app/index.ts</strong>:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> BullModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/bull"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/common"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigModule<span class="token punctuation">,</span> ConfigService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/config"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Joi <span class="token keyword">from</span> <span class="token string">"@hapi/joi"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    BullModule<span class="token punctuation">.</span><span class="token function">forRootAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>configService<span class="token operator">:</span> ConfigService<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        redis<span class="token operator">:</span> <span class="token punctuation">{</span>
          host<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">"REDIS_HOST"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          port<span class="token operator">:</span> <span class="token operator">+</span>configService<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">"REDIS_PORT"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      inject<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigService<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ConfigModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      validationSchema<span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token constant">EMAIL_HOST</span><span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token constant">EMAIL_PORT</span><span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token constant">EMAIL_ADDRESS</span><span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token constant">EMAIL_PASSWORD</span><span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token constant">REDIS_HOST</span><span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token constant">REDIS_PORT</span><span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<p>The <strong>main.ts</strong> file is identical, just like in the official documentation.<br>
However, I will paste it here just so that this article remains complete.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> NestFactory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/core"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Transport<span class="token punctuation">,</span> MicroserviceOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/microservices"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./app"</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createMicroservice</span><span class="token generic class-name"><span class="token operator">&lt;</span>MicroserviceOptions<span class="token operator">></span></span></span><span class="token punctuation">(</span>
    AppModule<span class="token punctuation">,</span>
    <span class="token punctuation">{</span> transport<span class="token operator">:</span> Transport<span class="token punctuation">.</span><span class="token constant">TCP</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<hr>
<h2 id="3-programming-the-mail-module" style="position:relative;"><a href="#3-programming-the-mail-module" aria-label="3 programming the mail module permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Programming the Mail module</h2>
<p>Ok, now we can do what tigers 🐅 like the most, which is to program the mail module that will be responsible for all the logic. Let’s start with the simplest one, which is programming the constants.</p>
<h3 id="31-create-the-constants-file" style="position:relative;"><a href="#31-create-the-constants-file" aria-label="31 create the constants file permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.1. Create the constants file</h3>
<p>In the constants directory, create the file <strong>mail.constant.ts</strong>:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">MAIL_QUEUE</span> <span class="token operator">=</span> <span class="token string">"MAIL_QUEUE"</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">CONFIRM_REGISTRATION</span> <span class="token operator">=</span> <span class="token string">"CONFIRM_REGISTRATION"</span><span class="token punctuation">;</span></code></pre></div>
<blockquote>
<p><strong>Note</strong>: You may have already noticed that each directory contains an <strong>index.ts</strong> file. It contains an export of the entire contents of all files in that directory. This allows for elegant import paths.</p>
</blockquote>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">"./mail.constant"</span><span class="token punctuation">;</span></code></pre></div>
<p><code class="language-text">MAIL_QUEUE</code> is a variable representing the name of the queue, and <code class="language-text">CONFIRM_REGISTRATION</code> is the name of the process being executed. In our case, we are creating an account registration confirmation mailing.</p>
<h3 id="32-create-a-mail-template" style="position:relative;"><a href="#32-create-a-mail-template" aria-label="32 create a mail template permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.2. Create a mail template</h3>
<p>As I wrote earlier, we use the handlebars template engine. This is a popular solution for Node.js applications. It allows you to pass variables, create loops and more.</p>
<p>Create <strong>registration.hbs</strong> file in templates directory:</p>
<div class="gatsby-highlight" data-language="handlebars"><pre class="language-handlebars"><code class="language-handlebars"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    Yo 😄
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
    Thank you for registering in our app.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
    Click on the link to confirm your account.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
    <span class="token handlebars language-handlebars"><span class="token delimiter punctuation">{{</span><span class="token variable">confirmUrl</span><span class="token delimiter punctuation">}}</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></div>
<h3 id="33-create-a-mail-processor" style="position:relative;"><a href="#33-create-a-mail-processor" aria-label="33 create a mail processor permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.3. Create a mail processor</h3>
<p>The processor is responsible for processing tasks in the queue. I added comments to places in the code that are very important.</p>
<p>In the processors directory, create <strong>mail.processor.ts</strong> file:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> MailerService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs-modules/mailer"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Process<span class="token punctuation">,</span> Processor <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/bull"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> Logger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/common"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/config"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Job <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"bull"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">CONFIRM_REGISTRATION</span><span class="token punctuation">,</span> <span class="token constant">MAIL_QUEUE</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../constants"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Processor</span></span><span class="token punctuation">(</span><span class="token constant">MAIL_QUEUE</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MailProcessor</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> _logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span>MailProcessor<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> _mailerService<span class="token operator">:</span> MailerService<span class="token punctuation">,</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> _configService<span class="token operator">:</span> ConfigService<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Process</span></span><span class="token punctuation">(</span><span class="token constant">CONFIRM_REGISTRATION</span><span class="token punctuation">)</span> <span class="token comment">// here is the name of the executed process</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">confirmRegistration</span><span class="token punctuation">(</span>
    job<span class="token operator">:</span> Job<span class="token operator">&lt;</span><span class="token punctuation">{</span> emailAddress<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> confirmUrl<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sending confirm registration email to '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>job<span class="token punctuation">.</span>data<span class="token punctuation">.</span>emailAddress<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_mailerService<span class="token punctuation">.</span><span class="token function">sendMail</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        to<span class="token operator">:</span> job<span class="token punctuation">.</span>data<span class="token punctuation">.</span>emailAddress<span class="token punctuation">,</span>
        from<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_configService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"EMAIL_ADDRESS"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        subject<span class="token operator">:</span> <span class="token string">"Registration"</span><span class="token punctuation">,</span>
        template<span class="token operator">:</span> <span class="token string">"./registration"</span><span class="token punctuation">,</span> <span class="token comment">// ! it must point to a template file name without the .hbs extension</span>
        context<span class="token operator">:</span> <span class="token punctuation">{</span> confirmUrl<span class="token operator">:</span> job<span class="token punctuation">.</span>data<span class="token punctuation">.</span>confirmUrl <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// here you pass the variables that you use in the hbs template</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to send confirmation email to '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>job<span class="token punctuation">.</span>data<span class="token punctuation">.</span>emailAddress<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>If you want more information about queued tasks, you can add an additional 3 methods:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">OnQueueActive</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token function">onActive</span><span class="token punctuation">(</span>job<span class="token operator">:</span> Job<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Processing job </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>job<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> of type </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>job<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">OnQueueCompleted</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token function">onComplete</span><span class="token punctuation">(</span>job<span class="token operator">:</span> Job<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Completed job </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>job<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> of type </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>job<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">OnQueueFailed</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token function">onError</span><span class="token punctuation">(</span>job<span class="token operator">:</span> Job<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed job </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>job<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> of type </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>job<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    error<span class="token punctuation">.</span>stack<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<blockquote>
<p><strong>Note</strong>: You can read more about queues in the <a href="https://docs.nestjs.com/techniques/queues" target="_blank" rel="nofollow noopener noreferrer">official NestJS documentation</a>.</p>
</blockquote>
<h3 id="34-create-a-mail-service" style="position:relative;"><a href="#34-create-a-mail-service" aria-label="34 create a mail service permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.4. Create a mail service</h3>
<p>We will now program a service to add a new task (i.e. sending an email) to the queue.<br>
In the services directory, create a file named <strong>mail.service.ts</strong>:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> Logger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/common"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">CONFIRM_REGISTRATION</span><span class="token punctuation">,</span> <span class="token constant">MAIL_QUEUE</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../constants"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Queue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"bull"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> InjectQueue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/bull"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> _logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span>MailService<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">InjectQueue</span></span><span class="token punctuation">(</span><span class="token constant">MAIL_QUEUE</span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">readonly</span> _mailQueue<span class="token operator">:</span> Queue<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">sendConfirmationEmail</span><span class="token punctuation">(</span>
    emailAddress<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    confirmUrl<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_mailQueue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_REGISTRATION</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        emailAddress<span class="token punctuation">,</span>
        confirmUrl<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error queueing registration email to user </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>emailAddress<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>I think this method is simple enough that there is no need to describe it.</p>
<h3 id="35-create-a-mail-controller" style="position:relative;"><a href="#35-create-a-mail-controller" aria-label="35 create a mail controller permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.5. Create a mail controller</h3>
<p>Once we have the service and processor programmed, we need to create a controller to run it all.<br>
Create a <strong>mail.controller.ts</strong> file in the controllers directory.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Controller <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/common"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EventPattern <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/microservices"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MailService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../services"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MailController</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> _mailService<span class="token operator">:</span> MailService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">EventPattern</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> cmd<span class="token operator">:</span> <span class="token string">"send-message"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">sendConfirmationEmail</span><span class="token punctuation">(</span>
    emailAddress<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    confirmUrl<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_mailService<span class="token punctuation">.</span><span class="token function">sendConfirmationEmail</span><span class="token punctuation">(</span>emailAddress<span class="token punctuation">,</span> confirmUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<blockquote>
<p><strong>Note</strong>: this microservice will listen for the <code class="language-text">send-message</code> command. You can read more about it <a href="https://docs.nestjs.com/microservices/basics#event-based" target="_blank" rel="nofollow noopener noreferrer">here</a>.</p>
</blockquote>
<h3 id="36-inject-created-classes-into-the-main-module-file" style="position:relative;"><a href="#36-inject-created-classes-into-the-main-module-file" aria-label="36 inject created classes into the main module file permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.6. Inject created classes into the main module file</h3>
<p>We already have everything we need. We just need to combine it in the main module file.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigModule<span class="token punctuation">,</span> ConfigService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/config"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/common"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MailerModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs-modules/mailer"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HandlebarsAdapter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs-modules/mailer/dist/adapters/handlebars.adapter"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BullModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/bull"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">MAIL_QUEUE</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./constants"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MailProcessor <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./processors"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MailService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./services"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MailController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./controllers"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    ConfigModule<span class="token punctuation">,</span>
    MailerModule<span class="token punctuation">.</span><span class="token function">forRootAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
      inject<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigService<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token punctuation">(</span>configService<span class="token operator">:</span> ConfigService<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        transport<span class="token operator">:</span> <span class="token punctuation">{</span>
          host<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"EMAIL_HOST"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          port<span class="token operator">:</span> <span class="token operator">+</span>configService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"EMAIL_PORT"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          secure<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          auth<span class="token operator">:</span> <span class="token punctuation">{</span>
            user<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"EMAIL_ADDRESS"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            pass<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"EMAIL_PASSWORD"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          tls<span class="token operator">:</span> <span class="token punctuation">{</span> rejectUnauthorized<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        defaults<span class="token operator">:</span> <span class="token punctuation">{</span> from<span class="token operator">:</span> <span class="token string">'"NestJS Mailer" &lt;test@test.com>'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// the header of the received emails is defined here. Customize this for your application.</span>
        template<span class="token operator">:</span> <span class="token punctuation">{</span>
          dir<span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">"/templates"</span><span class="token punctuation">,</span> <span class="token comment">// here you must specify the path where the directory with all email templates is located</span>
          adapter<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">HandlebarsAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span> strict<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    BullModule<span class="token punctuation">.</span><span class="token function">registerQueue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token constant">MAIL_QUEUE</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>MailProcessor<span class="token punctuation">,</span> MailService<span class="token punctuation">]</span><span class="token punctuation">,</span>
  exports<span class="token operator">:</span> <span class="token punctuation">[</span>MailService<span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>MailController<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MailModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<p>Do not forget to import the created module into the main module of the application:</p>
<div class="gatsby-highlight" data-language="diff"><pre class="language-diff"><code class="language-diff">...
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> import { MailModule } from 'src/mail';
</span>
@Module({
<span class="token unchanged"><span class="token prefix unchanged"> </span> imports: [
<span class="token prefix unchanged"> </span>   ...
</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>   MailModule,
</span><span class="token unchanged"><span class="token prefix unchanged"> </span> ],
</span>})
export class AppModule {}</code></pre></div>
<p>So that’s it. We have the whole module programmed and ready to use! 🚀<br>
You can now compile the application and run it on an external server.</p>
<hr>
<h2 id="example-of-use" style="position:relative;"><a href="#example-of-use" aria-label="example of use permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example of use</h2>
<p>Implementing a microservice in NestJS is trivially easy. We need to import a specific module for connection and apply it to our service.
In our case, we will send an email address when a user is created.</p>
<ol>
<li>First, you need to start microservices in your <strong>main.ts</strong> file (in another NestJS application):</li>
</ol>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token operator">...</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MicroserviceOptions<span class="token punctuation">,</span> Transport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/microservices'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/config'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">connectMicroservice</span><span class="token generic class-name"><span class="token operator">&lt;</span>MicroserviceOptions<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    transport<span class="token operator">:</span> Transport<span class="token punctuation">.</span><span class="token constant">TCP</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      port<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'PORT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">startAllMicroservices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<ol start="2">
<li>In the module where you will want to use the microservice, declare a new object in the providers array:</li>
</ol>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token operator">...</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ClientProxyFactory<span class="token punctuation">,</span> Transport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/microservices'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      provide<span class="token operator">:</span> <span class="token string">'MAIL_SERVICE'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
        ClientProxyFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          transport<span class="token operator">:</span> Transport<span class="token punctuation">.</span><span class="token constant">TCP</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticationModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">MAIL_SERVICE</code> is the name of the microservice. You will refer to it through the constructor in the service.</p>
<ol start="3">
<li>Now apply the client at the appropriate place in your business logic:</li>
</ol>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token operator">...</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ClientProxy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/microservices'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticationService</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token string">'MAIL_SERVICE'</span><span class="token punctuation">)</span> <span class="token keyword">private</span> client<span class="token operator">:</span> ClientProxy<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token operator">...</span>

   <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">registration</span><span class="token punctuation">(</span><span class="token punctuation">{</span> emailAddress <span class="token punctuation">}</span><span class="token operator">:</span> RegistrationDto<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>UserEntity<span class="token operator">></span> <span class="token punctuation">{</span>
     <span class="token operator">...</span>

     <span class="token keyword">const</span> confirmUrl <span class="token operator">=</span> <span class="token string">"https://link.test?ey=testexample2"</span>
     <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subscribersService<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token punctuation">{</span> cmd<span class="token operator">:</span> <span class="token string">'send-message'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> emailAddress<span class="token punctuation">,</span> confirmUrl <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Remember that the cmd must be identical to the one defined in the microservice controller.
In the second argument, you pass the variables you need to send to the microservice.</p>
<p>That’s it, your monolithic application now is associated with the microservice and can use its services. 🙌</p>
<hr>
<h2 id="testing-the-mail-module" style="position:relative;"><a href="#testing-the-mail-module" aria-label="testing the mail module permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Testing the mail module</h2>
<p>The more experienced a developer I am, the more I realize how important testing is. My tests aren’t perfect, but I’m glad they are.</p>
<p>Below is my test named <strong>mail.controller.spec.ts</strong> for the mail controller:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> BullModule<span class="token punctuation">,</span> getQueueToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/bull"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Test<span class="token punctuation">,</span> TestingModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/testing"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">MAIL_QUEUE</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../constants"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MailController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../controllers"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MailService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../services"</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"MailController"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> controller<span class="token operator">:</span> MailController<span class="token punctuation">;</span>
  <span class="token keyword">let</span> moduleRef<span class="token operator">:</span> TestingModule<span class="token punctuation">;</span>

  <span class="token keyword">const</span> exampleQueueMock <span class="token operator">=</span> <span class="token punctuation">{</span> add<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    jest<span class="token punctuation">.</span><span class="token function">resetAllMocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    moduleRef <span class="token operator">=</span> <span class="token keyword">await</span> Test<span class="token punctuation">.</span><span class="token function">createTestingModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>
        BullModule<span class="token punctuation">.</span><span class="token function">registerQueue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token constant">MAIL_QUEUE</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      controllers<span class="token operator">:</span> <span class="token punctuation">[</span>MailController<span class="token punctuation">]</span><span class="token punctuation">,</span>
      providers<span class="token operator">:</span> <span class="token punctuation">[</span>MailService<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">overrideProvider</span><span class="token punctuation">(</span><span class="token function">getQueueToken</span><span class="token punctuation">(</span><span class="token constant">MAIL_QUEUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">useValue</span><span class="token punctuation">(</span>exampleQueueMock<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    controller <span class="token operator">=</span> moduleRef<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>MailController<span class="token operator">></span></span></span><span class="token punctuation">(</span>MailController<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should be defined"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeDefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>I also wrote a test for the mail service:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> BullModule<span class="token punctuation">,</span> getQueueToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/bull"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Test<span class="token punctuation">,</span> TestingModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/testing"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Queue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"bull"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">MAIL_QUEUE</span><span class="token punctuation">,</span> <span class="token constant">CONFIRM_REGISTRATION</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../constants"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MailService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../services"</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"MailService"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> service<span class="token operator">:</span> MailService<span class="token punctuation">;</span>
  <span class="token keyword">let</span> moduleRef<span class="token operator">:</span> TestingModule<span class="token punctuation">;</span>

  <span class="token keyword">const</span> exampleQueueMock <span class="token operator">=</span> <span class="token punctuation">{</span> add<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    jest<span class="token punctuation">.</span><span class="token function">resetAllMocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    moduleRef <span class="token operator">=</span> <span class="token keyword">await</span> Test<span class="token punctuation">.</span><span class="token function">createTestingModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>
        BullModule<span class="token punctuation">.</span><span class="token function">registerQueue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token constant">MAIL_QUEUE</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      providers<span class="token operator">:</span> <span class="token punctuation">[</span>MailService<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">overrideProvider</span><span class="token punctuation">(</span><span class="token function">getQueueToken</span><span class="token punctuation">(</span><span class="token constant">MAIL_QUEUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">useValue</span><span class="token punctuation">(</span>exampleQueueMock<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    service <span class="token operator">=</span> moduleRef<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>MailService<span class="token operator">></span></span></span><span class="token punctuation">(</span>MailService<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should inject the queue"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> queue <span class="token operator">=</span> moduleRef<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>Queue<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token function">getQueueToken</span><span class="token punctuation">(</span><span class="token constant">MAIL_QUEUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeDefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should be defined"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeDefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should dispatch job"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> service<span class="token punctuation">.</span><span class="token function">sendConfirmationEmail</span><span class="token punctuation">(</span>
      <span class="token string">"test@test.com"</span><span class="token punctuation">,</span>
      <span class="token string">"http://link.com?token=ey"</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>exampleQueueMock<span class="token punctuation">.</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_REGISTRATION</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      confirmUrl<span class="token operator">:</span> <span class="token string">"http://link.com?token=ey"</span><span class="token punctuation">,</span>
      emailAddress<span class="token operator">:</span> <span class="token string">"test@test.com"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>After executing yarn test, you will get the following result:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ jest
 PASS  src/mail/tests/mail.service.spec.ts
 PASS  src/mail/tests/mail.controller.spec.ts
Test Suites: 2 passed, 2 total
Tests:       4 passed, 4 total
Snapshots:   0 total
Time:        5.225 s
Ran all test suites.
✨  Done in 6.56s.</code></pre></div>
<hr>
<p>In this article, we learned how to implement a queue for sending e-mails using a microservice.
We have written a comprehensive application and prepared tests for it.</p>
<p>You can also find this article on <a href="https://medium.com/@pietrzakadrian" target="_blank" rel="nofollow noopener noreferrer">medium.com</a> where I share my solutions to the problems I encountered during my software engineer career.</p></div></div></div><div><div class="Copyright-module--copyright--766ee">© All rights reserved.</div></div><div class="Post-module--footer--f8705"><div class="Tags-module--tags--18589"><ul class="Tags-module--list--82ae6"><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/nodejs/">NodeJS</a></li><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/typescript/">TypeScript</a></li><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/nestjs/">NestJS</a></li></ul></div></div><div class="Post-module--comments--d3b99"><div></div></div><hr/><div><h2>Related articles</h2><section class="Related-module--related--75a7f"><div class="Feed-module--feed--a6204"><div class="Feed-module--item--c7a63"><div class="Feed-module--meta--250c2"><time class="Feed-module--time--72864" dateTime="February 13, 2022">February 13, 2022</time><span class="Feed-module--divider--81a18">—</span><small>21<!-- --> min read</small></div><h2 class="Feed-module--title--f252f"><a class="Feed-module--link--6123b" href="/blog/nestjs-authentication-series/user-registration">NestJS Authentication Series 🔐: Part 1 - User registration</a></h2><p class="Feed-module--description--57348">Welcome you to my blog series on user authentication in the NestJS framework. This series is a set of several tutorials that extend the official documentation. If you are programming an enterprise application, you will most likely want to include full user support, i.e. email account confirmation, password reminder capability, etc. This post is the first part in a series and below you can find a list of all the other articles on this topic.</p><div class="Feed-module--bottom--dd480"><div class="Feed-module--tags--75a26"><div class="Tags-module--tags--18589"><ul class="Tags-module--list--82ae6"><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/typescript/">TypeScript</a></li><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/nodejs/">NodeJS</a></li><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/nestjs/">NestJS</a></li></ul></div></div></div></div><div class="Feed-module--item--c7a63"><div class="Feed-module--meta--250c2"><time class="Feed-module--time--72864" dateTime="November 23, 2021">November 23, 2021</time><span class="Feed-module--divider--81a18">—</span><small>3<!-- --> min read</small></div><h2 class="Feed-module--title--f252f"><a class="Feed-module--link--6123b" href="/blog/how-did-my-open-source-project-get-over-1k-stars-on-github">⭐️ How did my open source project get over 1k stars on GitHub?</a></h2><p class="Feed-module--description--57348">In 2019, I started working on my first larger software application than &quot;todo list&quot;. I was looking for a job as a software developer this year and I needed to distinguish myself from other developers. I made a banking system where you could make transfers (not real money). I&#x27;ve been looking for help from other developers to find out if my JavaScript code is good enough. By coincidence, my application has become one of the most popular open source projects and has received over 1.2k stars up to date.</p><div class="Feed-module--bottom--dd480"><div class="Feed-module--tags--75a26"><div class="Tags-module--tags--18589"><ul class="Tags-module--list--82ae6"><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/nodejs/">NodeJS</a></li><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/typescript/">TypeScript</a></li><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/react/">React</a></li></ul></div></div></div></div></div></section></div></div></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/how-to-create-a-microservice-that-handles-the-queue-of-sending-emails-in-nestjs";window.___webpackCompilationHash="824557d555d62bc09511";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-a8cddf54596e976d4134.js"],"app":["/app-2ffbf24983a07924de60.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-0c915c7b1bdb5eac4fdf.js"],"component---src-templates-blog-template-blog-template-tsx":["/component---src-templates-blog-template-blog-template-tsx-58bc8ceaed49b6bc6e96.js"],"component---src-templates-categories-template-categories-template-tsx":["/component---src-templates-categories-template-categories-template-tsx-e95e61bcac46a2493a97.js"],"component---src-templates-category-template-category-template-tsx":["/component---src-templates-category-template-category-template-tsx-28bfdccebef64c7a1a33.js"],"component---src-templates-certifications-template-certifications-template-tsx":["/component---src-templates-certifications-template-certifications-template-tsx-576c0e955466ae0e83b2.js"],"component---src-templates-collaboration-template-collaboration-template-tsx":["/component---src-templates-collaboration-template-collaboration-template-tsx-e730d234ae5ced168a8b.js"],"component---src-templates-home-template-home-template-tsx":["/component---src-templates-home-template-home-template-tsx-7a400f1de4d0f09c8628.js"],"component---src-templates-not-found-template-not-found-template-tsx":["/component---src-templates-not-found-template-not-found-template-tsx-ea68c7ff6de6afaebced.js"],"component---src-templates-page-template-page-template-tsx":["/component---src-templates-page-template-page-template-tsx-f4339b4ae2b8c66ab1fa.js"],"component---src-templates-post-template-post-template-tsx":["/component---src-templates-post-template-post-template-tsx-ee787588b7eee7fcc21c.js"],"component---src-templates-tag-template-tag-template-tsx":["/component---src-templates-tag-template-tag-template-tsx-5d805ab8a8401972f01a.js"],"component---src-templates-tags-template-tags-template-tsx":["/component---src-templates-tags-template-tags-template-tsx-68309a9b42b11997ffc7.js"]};/*]]>*/</script><script src="/polyfill-a8cddf54596e976d4134.js" nomodule=""></script><script src="/app-2ffbf24983a07924de60.js" async=""></script><script src="/framework-745d5d28c0250a1a333b.js" async=""></script><script src="/webpack-runtime-7def2bffd6c10822e0cc.js" async=""></script></body></html>