<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.7"/><meta name="description" content="If you are an experienced Node.js developer and use the TypeORM library in your project, you must have encountered the problem of creating a virtual field in the data model. We need this field in order to be able to return an additional result in the response, but we don&#x27;t want to store it directly in the database. What you are most likely looking for should be named .addSelectAndMap(), @VirtualColumn() or Computed Column decorator." data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta name="twitter:title" content="Virtual Column solutions for TypeORM — Adrian Pietrzak: Software Engineering Blog" data-gatsby-head="true"/><meta name="twitter:description" content="If you are an experienced Node.js developer and use the TypeORM library in your project, you must have encountered the problem of creating a virtual field in the data model. We need this field in order to be able to return an additional result in the response, but we don&#x27;t want to store it directly in the database. What you are most likely looking for should be named .addSelectAndMap(), @VirtualColumn() or Computed Column decorator." data-gatsby-head="true"/><meta name="og:title" content="Virtual Column solutions for TypeORM — Adrian Pietrzak: Software Engineering Blog" data-gatsby-head="true"/><meta name="og:type" content="website" data-gatsby-head="true"/><meta name="og:description" content="If you are an experienced Node.js developer and use the TypeORM library in your project, you must have encountered the problem of creating a virtual field in the data model. We need this field in order to be able to return an additional result in the response, but we don&#x27;t want to store it directly in the database. What you are most likely looking for should be named .addSelectAndMap(), @VirtualColumn() or Computed Column decorator." data-gatsby-head="true"/><meta name="image" content="https://pietrzakadrian.com/static/f3a632970afa4814eca776f0538ade86/thumbnail.jpeg" data-gatsby-head="true"/><meta name="og:image" content="https://pietrzakadrian.com/static/f3a632970afa4814eca776f0538ade86/thumbnail.jpeg" data-gatsby-head="true"/><meta name="twitter:image" content="https://pietrzakadrian.com/static/f3a632970afa4814eca776f0538ade86/thumbnail.jpeg" data-gatsby-head="true"/><meta name="theme-color" content="hsl(31, 92%, 62%)"/><style data-href="/styles.45e7941f55f0720d2696.css" data-identity="gatsby-global-css">:after,:before,:root{--color-white:#fff;--color-primary:#2c964a;--color-secondary:#2ea34f;--color-prism-background:#e2e5e9;--color-typographic-base-font:#242933;--color-typographic-link-p-font:#2ea34f;--color-typographic-link-s-font:#2c964a;--color-page-border:#e2e5e9;--color-page-background:#fff;--color-sidebar-border:#e2e5e9;--color-sidebar-border-fade:#fff;--color-contacts-border:#e2e5e9;--color-button-border:#e2e5e9;--color-button-color:#242933;--color-theme-switcher:#3f485a;--color-theme-switcher-hover:#2c964a;--color-tag-silver:#f5f7fa;--color-tag-silver-hover:#e6e6e6;--color-tag-silver-text:#242933;--color-input-border:#e2e5e9}.dark :after,.dark :before,:root.dark{--color-white:#fff;--color-primary:#548fc9;--color-secondary:#4082c4;--color-prism-background:#13161b;--color-typographic-base-font:#fff;--color-typographic-link-p-font:#4082c4;--color-typographic-link-s-font:#548fc9;--color-page-border:#3f485a;--color-page-background:#242933;--color-sidebar-border:#3f485a;--color-sidebar-border-fade:#242933;--color-contacts-border:#3f485a;--color-button-border:#3f485a;--color-button-color:#fff;--color-theme-switcher:#e2e5e9;--color-theme-switcher-hover:#4082c4;--color-tag-silver:#13161b;--color-tag-silver-hover:#3f485a;--color-tag-silver-text:#fff;--color-input-border:#13161b}html{font-size:100}body,html{overscroll-behavior-y:none}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;background:var(--color-page-background);color:var(--color-typographic-base-font);font-family:Gotham-Book,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif;font-size:16px;line-height:1.625;margin:0 0 0 calc(100vw - 100%);text-rendering:optimizelegibility}h1,h2,h3,h4,h5,h6{font-family:Butler,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1{font-size:40px;line-height:52px;margin-bottom:26px;margin-top:104px}h2{font-size:27px;line-height:39px}h2,h3{margin-bottom:13px;margin-top:52px}h3{font-size:22px;line-height:26px}h4{font-size:19.2px;margin-top:39px}h4,h5{line-height:26px;margin-bottom:13px}h5,h6{font-size:16px;margin-top:65px}h6{line-height:26px;margin-bottom:13px}img{max-width:100%}hr,img{border:0;display:block}hr{margin:20px auto;text-align:center;width:100px}hr,hr:before{color:var(--color-typographic-base-font)}hr:before{content:"⦁  ⦁  ⦁";font-size:15px}a{color:var(--color-typographic-link-p-font);text-decoration:none}a:active,a:focus,a:hover{color:var(--color-typographic-link-s-font)}b,strong{font-weight:600}ul{list-style:square;margin-bottom:26px}ul li{margin-bottom:10px;padding:0 5px}p{line-height:26px;margin-bottom:26px}blockquote{box-shadow:inset 3px 0 0 0 var(--color-typographic-base-font);font-style:italic;margin-left:0;padding-left:26px;text-align:left}figure{display:block;height:auto;width:100%}figcaption{color:var(--color-typographic-base-font);font-size:14px;font-style:italic;line-height:19.5px;margin-bottom:0;margin-top:6.5px;text-align:center}button{background-color:transparent}button,input{border-width:0;font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;line-height:inherit;padding:0}input:focus{outline:none}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:310px;padding:0 26px}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Fira Code,Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:14px;-webkit-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2e3440}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#636f88}.token.punctuation{color:#81a1c1}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#81a1c1}.token.number{color:#b48ead}.token.boolean{color:#81a1c1}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a3be8c}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#81a1c1}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#88c0d0}.token.keyword{color:#81a1c1}.token.important,.token.regex{color:#ebcb8b}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@font-face{font-display:swap;font-family:Gotham-Book;font-style:normal;font-weight:400;src:local("Gotham-Book"),url(/static/Gotham-Book-207b1f58e0df329a118662e5e3d7500b.eot?#iefix) format("embedded-opentype"),url(/static/Gotham-Book-b39f02e9da64e0412f2091961423b8a3.woff2) format("woff2"),url(/static/Gotham-Book-e872be4db2fd5c800fd8d1b9d0372fc9.woff) format("woff"),url(/static/Gotham-Book-4c2cf6d6bc07b328e8d00fc4b8c70ff9.ttf) format("truetype"),url(/static/Gotham-Book-827308a1a798e3fe077d466f9c1ad461.svg#Gotham-Book) format("svg")}@font-face{font-display:swap;font-family:Butler;font-style:normal;font-weight:400;src:local("Butler"),url(/static/Butler-4a42f1a5ba360aad73c4e68c45a9d538.eot?#iefix) format("embedded-opentype"),url(/static/Butler-99c7b1a6053c62da9427902eaab58690.woff2) format("woff2"),url(/static/Butler-7704cc6b567d92ede0f67d6060f8f5c3.woff) format("woff"),url(/static/Butler-86d94a8a10eba000cff7120d06fe9312.ttf) format("truetype"),url(/static/Butler-0b1942017c6ffdc0d629c82f0a6d2077.svg#Butler) format("svg")}.Collaboration-module--collaboration--77306 .Collaboration-module--button--1a15e{line-height:1;min-height:50px}.Button-module--button--b1113,.Button-module--link--ce317{display:flex;justify-content:center}.Button-module--button--b1113{align-items:center;background-color:var(--color-secondary);color:var(--color-white);font-weight:600;padding:10px 15px;text-align:center;transition:background-color .2s ease}.Button-module--button--b1113:hover{background-color:var(--color-primary);color:#fff;cursor:pointer}.Tags-module--tags--18589{margin-bottom:13px}.Tags-module--tags--18589 .Tags-module--list--82ae6{list-style:none;margin-top:0;padding:0}.Tags-module--tags--18589 .Tags-module--list--82ae6 .Tags-module--item--52015{display:inline-block;margin:6.5px 0;padding:0 6.5px 0 0}@media screen and (min-width:685px){.Tags-module--tags--18589 .Tags-module--list--82ae6 .Tags-module--item--52015:first-child{margin-left:0;padding-left:0}}.Tags-module--tags--18589 .Tags-module--list--82ae6 .Tags-module--item--52015 .Tags-module--button--421f7{align-items:center;background-color:var(--color-tag-silver);border:none;border-radius:20px;color:var(--color-tag-silver-text);display:flex;font-size:12px;height:26px;line-height:0;padding:0 13px;text-decoration:none;transition:background .1s ease}.Tags-module--tags--18589 .Tags-module--list--82ae6 .Tags-module--item--52015 .Tags-module--button--421f7:hover{background-color:var(--color-tag-silver-hover)}.Layout-module--layout--2c933{margin-left:auto;margin-right:auto;max-width:1070px}.Layout-module--layout--2c933:before{content:"";display:table}.Layout-module--layout--2c933:after{clear:both;content:"";display:table}.Feed-module--feed--a6204 .Feed-module--item--c7a63{margin-bottom:32.5px}.Feed-module--feed--a6204 .Feed-module--item--c7a63:last-child{margin-bottom:13px}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--title--f252f{font-size:27px;line-height:39px;margin-bottom:3.9px;margin-top:0}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--title--f252f .Feed-module--link--6123b{color:var(--color-typographic-base-font)}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--title--f252f .Feed-module--link--6123b:focus,.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--title--f252f .Feed-module--link--6123b:hover{border-bottom:1px solid var(--color-typographic-base-font);color:var(--color-typographic-base-font)}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--description--57348{-webkit-box-orient:vertical;-webkit-line-clamp:4;display:-webkit-box;font-size:16px;line-height:26px;margin-bottom:19.5px;margin-top:0;overflow:hidden}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--bottom--dd480{align-items:center;display:flex}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--bottom--dd480 small{align-items:center;color:#7f8ba4;display:flex;height:26px;white-space:nowrap}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--bottom--dd480 .Feed-module--tags--75a26 div,.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--bottom--dd480 .Feed-module--tags--75a26 li,.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--bottom--dd480 .Feed-module--tags--75a26 ul{margin:0}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--time--72864{color:#7f8ba4;font-size:14px;font-weight:600}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--divider--81a18{color:#7f8ba4;margin:0 6.5px}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 small{color:#7f8ba4;font-size:14px;font-weight:600}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--category--59f58 .Feed-module--link--6123b{color:var(--color-secondary);font-size:14px;font-weight:600;text-transform:uppercase}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--category--59f58 .Feed-module--link--6123b:focus,.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--meta--250c2 .Feed-module--category--59f58 .Feed-module--link--6123b:hover{color:#4082c4}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--more--51a4e{color:var(--color-primary);font-size:16px}.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--more--51a4e:focus,.Feed-module--feed--a6204 .Feed-module--item--c7a63 .Feed-module--more--51a4e:hover{border-bottom:1px solid var(--color-primary);color:var(--color-primary)}.Page-module--page--24e03{margin-bottom:52px}.Page-module--page--24e03 .Page-module--inner--4b31d{padding:26px 19.5px 0}.Page-module--page--24e03 a{font-weight:600}.Page-module--page--24e03 .Page-module--title--90338{font-size:40px;font-weight:600;line-height:52px;margin-bottom:37.7px;margin-top:0}.Page-module--page--24e03 .Page-module--body--561c4{font-size:16px;line-height:26px;margin:0 0 26px}@media screen and (min-width:685px){.Page-module--page--24e03{width:calc(58.275% - 12.5px)}.Page-module--page--24e03:nth-child(1n){clear:none;float:left;margin-right:30px}.Page-module--page--24e03:last-child{margin-right:0}.Page-module--page--24e03:nth-child(12n){float:right;margin-right:0}.Page-module--page--24e03:nth-child(12n+1){clear:both}.Page-module--page--24e03 .Page-module--inner--4b31d{padding:32.5px 19.5px 0}}@media screen and (min-width:960px){.Page-module--page--24e03{width:calc(66.6% - 10px)}.Page-module--page--24e03:nth-child(1n){clear:none;float:left;margin-right:30px}.Page-module--page--24e03:last-child{margin-right:0}.Page-module--page--24e03:nth-child(3n){float:right;margin-right:0}.Page-module--page--24e03:nth-child(3n+1){clear:both}.Page-module--page--24e03 .Page-module--inner--4b31d{padding:39px 26px 0}}.Pagination-module--pagination--d61cb{display:flex;margin-top:52px}.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b{text-align:left;width:50%}.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b .Pagination-module--previousLink--5590d{color:var(--color-secondary);font-size:26px;font-weight:700}.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b .Pagination-module--previousLink--5590d:focus,.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b .Pagination-module--previousLink--5590d:hover{color:var(--color-primary)}.Pagination-module--pagination--d61cb .Pagination-module--previous--4a76b .Pagination-module--previousLink--5590d.Pagination-module--disable--7e105{color:#3f485a;pointer-events:none}.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8{text-align:right;width:50%}.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8 .Pagination-module--nextLink--532ff{color:var(--color-secondary);font-size:26px;font-weight:700}.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8 .Pagination-module--nextLink--532ff:focus,.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8 .Pagination-module--nextLink--532ff:hover{color:var(--color-primary)}.Pagination-module--pagination--d61cb .Pagination-module--next--1cab8 .Pagination-module--nextLink--532ff.Pagination-module--disable--7e105{color:#3f485a;pointer-events:none}.Related-module--related--75a7f .Related-module--header--4fb3a{margin-top:0}.Meta-module--meta--dae0a{color:#7f8ba4;display:flex;font-size:14px;font-weight:600}.Meta-module--meta--dae0a p{margin:0}.Meta-module--meta--dae0a span{margin:0 6px}.ThemeSwitcher-module--themeSwitcher--8a77f{--color:var(--color-theme-switcher)}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--button--7cb7b{align-items:center;background:transparent;border:0;cursor:pointer;display:flex;justify-content:center;outline:0}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--button--7cb7b svg{stroke:var(--color);pointer-events:none;transition:stroke .4s}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--button--7cb7b:hover{--color:var(--color-theme-switcher-hover)}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--moon--10537{stroke-dasharray:0 1px;opacity:0;transition:stroke-dasharray .2s ease-in,opacity .4s ease-in}.ThemeSwitcher-module--themeSwitcher--8a77f .ThemeSwitcher-module--sun--2163a{stroke-dasharray:1px 1px;opacity:1;transition:stroke-dasharray .2s ease-in,opacity .4s ease-in}.ThemeSwitcher-module--themeSwitcher--8a77f.ThemeSwitcher-module--dark--6db0c .ThemeSwitcher-module--moon--10537{stroke-dasharray:1px 1px;opacity:1}.ThemeSwitcher-module--themeSwitcher--8a77f.ThemeSwitcher-module--dark--6db0c .ThemeSwitcher-module--sun--2163a{stroke-dasharray:0 1px;opacity:0}.Author-module--author--1c58d{align-items:center;display:flex;justify-content:space-between;line-height:26px;margin-bottom:39px;margin-top:13px;max-width:640px}.Author-module--author--1c58d .Author-module--photo--b037c{background-clip:padding-box;border-radius:50%;display:inline-block;height:50px;margin-bottom:0;margin-right:13px;width:50px}.Author-module--author--1c58d .Author-module--photo--b037c img{border-radius:50%}.Author-module--author--1c58d p,.Author-module--author--1c58d span,.Author-module--author--1c58d strong{line-height:1}.Author-module--author--1c58d .Author-module--information--20ba9{align-items:center;display:flex}.Author-module--author--1c58d .Author-module--information--20ba9 .Author-module--wrapper--5b181{display:flex;flex-direction:column;gap:5px}@media screen and (min-width:685px){.Author-module--author--1c58d{margin-left:auto;margin-right:auto}}.Content-module--content--80d58{margin:0 auto;max-width:945px;padding:0}.Content-module--content--80d58 .Content-module--title--09504{font-size:32px;font-weight:600;line-height:42.9px;margin:0 auto;max-width:640px;text-align:left}.Content-module--content--80d58 h1{font-size:28.8px;margin-top:26px}.Content-module--content--80d58 h2{font-size:24px}.Content-module--content--80d58 .Content-module--body--726c2 figure{margin-bottom:26px}.Content-module--content--80d58 .Content-module--body--726c2 figure blockquote{font-style:italic;margin-top:0;padding:26px 0}.Content-module--content--80d58 .Content-module--body--726c2 figure blockquote p{font-size:26.9072px;line-height:39px;margin-bottom:26px;margin-top:0;max-width:640px}.Content-module--content--80d58 .Content-module--body--726c2 a{text-decoration:underline}.Content-module--content--80d58 .Content-module--body--726c2 *{margin-left:auto;margin-right:auto;max-width:640px}.Content-module--content--80d58 .Content-module--body--726c2 h2>a{visibility:hidden}.Content-module--content--80d58 .Content-module--body--726c2 h2>a>svg{fill:var(--color-typographic-base-font)}.Content-module--content--80d58 .Content-module--body--726c2 img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--80d58{padding:0}.Content-module--content--80d58 .Content-module--title--09504{font-size:48px;line-height:58.5px;margin-bottom:0;margin-top:0}.Content-module--content--80d58 .Content-module--body--726c2,.Content-module--content--80d58 .Content-module--body--726c2 p{font-size:18px;line-height:29.25px;margin-bottom:29.25px}.Content-module--content--80d58 .Content-module--body--726c2 h2>a{padding-right:13px;visibility:unset}}.Copyright-module--copyright--766ee{color:#7f8ba4;font-size:14px}.Post-module--post--3a994 .Post-module--content--3c6e5{margin:0 auto}.Post-module--post--3a994 .Post-module--footer--f8705{margin:0;max-width:640px;padding:0}.Post-module--post--3a994 .Post-module--comments--d3b99{margin:0 auto;max-width:640px;padding:0!important}@media screen and (min-width:960px){.Post-module--post--3a994 .Post-module--footer--f8705{padding:0}}.Author-module--author--cbd31 .Author-module--photo--9787b{background-clip:padding-box;border-radius:50%;display:inline-block;height:75px;margin-bottom:0;width:75px}.Author-module--author--cbd31 .Author-module--photo--9787b img{border-radius:50%}.Author-module--author--cbd31 .Author-module--title--cf7e5{font-family:Gotham-Book,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif;font-size:18px;font-weight:600;line-height:29.25px;margin:0}.Author-module--author--cbd31 .Author-module--title--cf7e5 .Author-module--link--09c17,.Author-module--author--cbd31 .Author-module--title--cf7e5 .Author-module--link--09c17:focus,.Author-module--author--cbd31 .Author-module--title--cf7e5 .Author-module--link--09c17:hover{color:var(--color-typographic-base-font)}.Author-module--author--cbd31 .Author-module--subtitle--86ec5{color:#7f8ba4;line-height:26px;margin-bottom:26px}.Author-module--author--cbd31 .Author-module--titleContainer--4f576{align-items:center;display:flex;justify-content:space-between;margin:13px 0}.Icon-module--icon--1d7da{fill:currentcolor;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;speak:none;stroke:currentcolor;stroke-width:0;display:inline-block;font-style:normal;font-variant:normal;font-weight:400;height:1.5em;line-height:1em;text-align:center;text-transform:none;width:1.5em}.Contacts-module--contacts--09178{margin-bottom:26px}.Contacts-module--contacts--09178 .Contacts-module--list--9670b{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;margin:0;max-width:150px;padding:0}.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0{align-content:center;align-items:center;display:flex;height:40px;justify-content:center;line-height:40px;margin:9.1px;padding:0;text-align:center}.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0:nth-child(3n+1){margin-left:0}.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0 .Contacts-module--link--de1e0{border:0;color:var(--color-typographic-base-font);cursor:pointer;display:flex;transition:color .2s ease}.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0 .Contacts-module--link--de1e0:focus,.Contacts-module--contacts--09178 .Contacts-module--list--9670b .Contacts-module--item--f9cb0 .Contacts-module--link--de1e0:hover{color:var(--color-typographic-link-p-font)}.Menu-module--menu--113a9{margin-bottom:26px}.Menu-module--menu--113a9 .Menu-module--list--e1ae3{list-style:none;margin:0;padding:0}.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679{margin:13px 0;padding:0}.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679 .Menu-module--link--a6f02{border:0;color:var(--color-typographic-base-font);font-size:16px;font-weight:400}.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679 .Menu-module--link--a6f02:focus,.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679 .Menu-module--link--a6f02:hover{border-bottom:1px solid var(--color-primary);color:var(--color-primary)}.Menu-module--menu--113a9 .Menu-module--list--e1ae3 .Menu-module--item--8b679 .Menu-module--link--a6f02.Menu-module--active--6cb74{border-bottom:1px solid var(--color-typographic-base-font);color:var(--color-typographic-base-font);font-weight:600}.Sidebar-module--sidebar--1bfa1{position:-webkit-sticky;position:sticky;width:100%}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0{padding:26px 19.5px 0;position:relative}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0:after{background:var(--color-sidebar-border);background:linear-gradient(to bottom,var(--color-sidebar-border) 0,var(--color-sidebar-border) 48%,var(--color-sidebar-border-fade) 100%)}@media screen and (min-width:685px){.Sidebar-module--sidebar--1bfa1{top:0;width:calc(41.625% - 17.5px)}.Sidebar-module--sidebar--1bfa1:nth-child(1n){clear:none;float:left;margin-right:30px}.Sidebar-module--sidebar--1bfa1:last-child{margin-right:0}.Sidebar-module--sidebar--1bfa1:nth-child(12n){float:right;margin-right:0}.Sidebar-module--sidebar--1bfa1:nth-child(12n+1){clear:both}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0{padding:32.5px 19.5px 0}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0:after{bottom:0;content:"";height:540px;position:absolute;right:-10px;top:30px;width:1px}}@media screen and (min-width:960px){.Sidebar-module--sidebar--1bfa1{width:calc(33.3% - 20px)}.Sidebar-module--sidebar--1bfa1:nth-child(1n){clear:none;float:left;margin-right:30px}.Sidebar-module--sidebar--1bfa1:last-child{margin-right:0}.Sidebar-module--sidebar--1bfa1:nth-child(3n){float:right;margin-right:0}.Sidebar-module--sidebar--1bfa1:nth-child(3n+1){clear:both}.Sidebar-module--sidebar--1bfa1 .Sidebar-module--inner--344d0{padding:39px}}</style><title data-gatsby-head="true">Virtual Column solutions for TypeORM — Adrian Pietrzak: Software Engineering Blog</title><link rel="alternate" type="application/rss+xml" title="Adrian Pietrzak" href="/blog/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-205649365-1"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-205649365-1', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=44654e347188ff02bbe25c28926e9968" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=44654e347188ff02bbe25c28926e9968"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=44654e347188ff02bbe25c28926e9968"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=44654e347188ff02bbe25c28926e9968"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=44654e347188ff02bbe25c28926e9968"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=44654e347188ff02bbe25c28926e9968"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=44654e347188ff02bbe25c28926e9968"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=44654e347188ff02bbe25c28926e9968"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=44654e347188ff02bbe25c28926e9968"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script></head><body><script>
          void function() {
            var cachedMode;

            try {
              var preferredTheme = JSON.parse(localStorage.getItem('diesel:theme-atom'));

              if (preferredTheme && preferredTheme.mode) {
                cachedMode = preferredTheme.mode;
              }
            } catch (err) { }

            function setTheme(newTheme) {
              document.documentElement.className = newTheme;
            }

            var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

            setTheme(cachedMode || (darkQuery.matches ? 'dark' : 'light'));
          }()
        </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--2c933"><div class="Sidebar-module--sidebar--1bfa1"><div class="Sidebar-module--inner--344d0"><div class="Author-module--author--cbd31"><a href="/blog"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained Author-module--photo--9787b"><div style="max-width:960px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;960&#x27; width=&#x27;960&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/avif" data-srcset="/static/44654e347188ff02bbe25c28926e9968/7234b/photo.avif 240w,/static/44654e347188ff02bbe25c28926e9968/0f4b9/photo.avif 480w,/static/44654e347188ff02bbe25c28926e9968/c42ce/photo.avif 960w" sizes="(min-width: 960px) 960px, 100vw"/><source type="image/webp" data-srcset="/static/44654e347188ff02bbe25c28926e9968/8d565/photo.webp 240w,/static/44654e347188ff02bbe25c28926e9968/21b1a/photo.webp 480w,/static/44654e347188ff02bbe25c28926e9968/d6f60/photo.webp 960w" sizes="(min-width: 960px) 960px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 960px) 960px, 100vw" decoding="async" loading="lazy" data-src="/static/44654e347188ff02bbe25c28926e9968/3f279/photo.png" data-srcset="/static/44654e347188ff02bbe25c28926e9968/87351/photo.png 240w,/static/44654e347188ff02bbe25c28926e9968/ec333/photo.png 480w,/static/44654e347188ff02bbe25c28926e9968/3f279/photo.png 960w" alt="Adrian Pietrzak"/></picture><noscript><picture><source type="image/avif" srcSet="/static/44654e347188ff02bbe25c28926e9968/7234b/photo.avif 240w,/static/44654e347188ff02bbe25c28926e9968/0f4b9/photo.avif 480w,/static/44654e347188ff02bbe25c28926e9968/c42ce/photo.avif 960w" sizes="(min-width: 960px) 960px, 100vw"/><source type="image/webp" srcSet="/static/44654e347188ff02bbe25c28926e9968/8d565/photo.webp 240w,/static/44654e347188ff02bbe25c28926e9968/21b1a/photo.webp 480w,/static/44654e347188ff02bbe25c28926e9968/d6f60/photo.webp 960w" sizes="(min-width: 960px) 960px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 960px) 960px, 100vw" decoding="async" loading="lazy" src="/static/44654e347188ff02bbe25c28926e9968/3f279/photo.png" srcSet="/static/44654e347188ff02bbe25c28926e9968/87351/photo.png 240w,/static/44654e347188ff02bbe25c28926e9968/ec333/photo.png 480w,/static/44654e347188ff02bbe25c28926e9968/3f279/photo.png 960w" alt="Adrian Pietrzak"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a><div class="Author-module--titleContainer--4f576"><h2 class="Author-module--title--cf7e5"><a class="Author-module--link--09c17" href="/blog">Adrian Pietrzak</a></h2></div><p class="Author-module--subtitle--86ec5">Software Engineer from Poland. Over 6 years of professional experience in develop apps.</p></div><nav class="Menu-module--menu--113a9"><ul class="Menu-module--list--e1ae3"><li class="Menu-module--item--8b679"><a class="Menu-module--link--a6f02" href="/blog">Articles</a></li><li class="Menu-module--item--8b679"><a class="Menu-module--link--a6f02" href="/portrait">Portrait</a></li><li class="Menu-module--item--8b679"><a class="Menu-module--link--a6f02" href="/tools">Tools</a></li><li class="Menu-module--item--8b679"><a class="Menu-module--link--a6f02" href="/certifications">Certifications</a></li><li class="Menu-module--item--8b679"><a class="Menu-module--link--a6f02" href="/collaboration">Collaboration ✨</a></li><li class="Menu-module--item--8b679"><a class="Menu-module--link--a6f02" href="/privacy-policy">Privacy policy</a></li></ul></nav><div class="Contacts-module--contacts--09178"><ul class="Contacts-module--list--9670b"><li class="Contacts-module--item--f9cb0"><span class="Contacts-module--link--de1e0"><svg class="Icon-module--icon--1d7da" viewBox="0 0 29 30"><title>email</title><path d="M26 23.5v-12c-0.328 0.375-0.688 0.719-1.078 1.031-2.234 1.719-4.484 3.469-6.656 5.281-1.172 0.984-2.625 2.188-4.25 2.188h-0.031c-1.625 0-3.078-1.203-4.25-2.188-2.172-1.813-4.422-3.563-6.656-5.281-0.391-0.313-0.75-0.656-1.078-1.031v12c0 0.266 0.234 0.5 0.5 0.5h23c0.266 0 0.5-0.234 0.5-0.5zM26 7.078c0-0.391 0.094-1.078-0.5-1.078h-23c-0.266 0-0.5 0.234-0.5 0.5 0 1.781 0.891 3.328 2.297 4.438 2.094 1.641 4.188 3.297 6.266 4.953 0.828 0.672 2.328 2.109 3.422 2.109h0.031c1.094 0 2.594-1.437 3.422-2.109 2.078-1.656 4.172-3.313 6.266-4.953 1.016-0.797 2.297-2.531 2.297-3.859zM28 6.5v17c0 1.375-1.125 2.5-2.5 2.5h-23c-1.375 0-2.5-1.125-2.5-2.5v-17c0-1.375 1.125-2.5 2.5-2.5h23c1.375 0 2.5 1.125 2.5 2.5z"></path></svg></span></li><li class="Contacts-module--item--f9cb0"><a class="Contacts-module--link--de1e0" href="https://github.com/pietrzakadrian" target="_blank" rel="noopener noreferrer"><svg class="Icon-module--icon--1d7da" viewBox="0 0 24 24"><title>github</title><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li><li class="Contacts-module--item--f9cb0"><a class="Contacts-module--link--de1e0" href="https://www.twitter.com/pietrzakadrian" target="_blank" rel="noopener noreferrer"><svg class="Icon-module--icon--1d7da" viewBox="0 0 24 24"><title>twitter</title><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"></path></svg></a></li></ul></div></div></div><div class="Page-module--page--24e03"><div class="Page-module--inner--4b31d"><div class="Page-module--body--561c4"><div class="Post-module--post--3a994"><div class="Post-module--content--3c6e5"><div class="Content-module--content--80d58"><h1 class="Content-module--title--09504">Virtual Column solutions for TypeORM</h1><div class="Author-module--author--1c58d"><div class="Author-module--information--20ba9"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained Author-module--photo--b037c"><div style="max-width:960px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;960&#x27; width=&#x27;960&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/avif" data-srcset="/static/44654e347188ff02bbe25c28926e9968/7234b/photo.avif 240w,/static/44654e347188ff02bbe25c28926e9968/0f4b9/photo.avif 480w,/static/44654e347188ff02bbe25c28926e9968/c42ce/photo.avif 960w" sizes="(min-width: 960px) 960px, 100vw"/><source type="image/webp" data-srcset="/static/44654e347188ff02bbe25c28926e9968/8d565/photo.webp 240w,/static/44654e347188ff02bbe25c28926e9968/21b1a/photo.webp 480w,/static/44654e347188ff02bbe25c28926e9968/d6f60/photo.webp 960w" sizes="(min-width: 960px) 960px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 960px) 960px, 100vw" decoding="async" loading="lazy" data-src="/static/44654e347188ff02bbe25c28926e9968/3f279/photo.png" data-srcset="/static/44654e347188ff02bbe25c28926e9968/87351/photo.png 240w,/static/44654e347188ff02bbe25c28926e9968/ec333/photo.png 480w,/static/44654e347188ff02bbe25c28926e9968/3f279/photo.png 960w" alt="Adrian Pietrzak"/></picture><noscript><picture><source type="image/avif" srcSet="/static/44654e347188ff02bbe25c28926e9968/7234b/photo.avif 240w,/static/44654e347188ff02bbe25c28926e9968/0f4b9/photo.avif 480w,/static/44654e347188ff02bbe25c28926e9968/c42ce/photo.avif 960w" sizes="(min-width: 960px) 960px, 100vw"/><source type="image/webp" srcSet="/static/44654e347188ff02bbe25c28926e9968/8d565/photo.webp 240w,/static/44654e347188ff02bbe25c28926e9968/21b1a/photo.webp 480w,/static/44654e347188ff02bbe25c28926e9968/d6f60/photo.webp 960w" sizes="(min-width: 960px) 960px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 960px) 960px, 100vw" decoding="async" loading="lazy" src="/static/44654e347188ff02bbe25c28926e9968/3f279/photo.png" srcSet="/static/44654e347188ff02bbe25c28926e9968/87351/photo.png 240w,/static/44654e347188ff02bbe25c28926e9968/ec333/photo.png 480w,/static/44654e347188ff02bbe25c28926e9968/3f279/photo.png 960w" alt="Adrian Pietrzak"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><div class="Author-module--wrapper--5b181"><strong>Adrian Pietrzak</strong><div class="Meta-module--meta--dae0a"><p>Aug 24, 2021</p><span>—</span><p>10<!-- --> min read</p></div></div></div></div><div class="Content-module--body--726c2"><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f3a632970afa4814eca776f0538ade86/e5166/thumbnail.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 52.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUDBAb/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABdLmuRSUplf/EABsQAQACAgMAAAAAAAAAAAAAAAEAAwIRBBIi/9oACAEBAAEFAjtOZbNEDUfVzkj/AP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EAB0QAAIABwEAAAAAAAAAAAAAAAABEBETMTJRcZH/2gAIAQEABj8CKafTD1wc9lz/xAAcEAACAwADAQAAAAAAAAAAAAABEQAhMUFRYcH/2gAIAQEAAT8habqBzPZ7H9B9gAqbBu0JAED4n//aAAwDAQACAAMAAAAQ3P8A/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8QZ//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPxCRj//EAB4QAQACAgEFAAAAAAAAAAAAAAEAESExQVFhobHw/9oACAEBAAE/EFUAeqThArLkNhz6eI326c0a99n7UHhQCjKxK2TKuliHioGB4n//2Q=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/f3a632970afa4814eca776f0538ade86/8ac56/thumbnail.webp 240w,
/static/f3a632970afa4814eca776f0538ade86/d3be9/thumbnail.webp 480w,
/static/f3a632970afa4814eca776f0538ade86/e46b2/thumbnail.webp 960w,
/static/f3a632970afa4814eca776f0538ade86/92f8c/thumbnail.webp 1200w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/f3a632970afa4814eca776f0538ade86/09b79/thumbnail.jpg 240w,
/static/f3a632970afa4814eca776f0538ade86/7cc5e/thumbnail.jpg 480w,
/static/f3a632970afa4814eca776f0538ade86/6a068/thumbnail.jpg 960w,
/static/f3a632970afa4814eca776f0538ade86/e5166/thumbnail.jpg 1200w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/jpeg"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/f3a632970afa4814eca776f0538ade86/6a068/thumbnail.jpg"
            alt="Thumbnail"
            title="Thumbnail"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<blockquote>
<p>❗ The below article is applicable to TypeORM in version 0.2.37 (released on 08/13/2021). Before reading, check if there is already a new version with a solution to this issue: <a href="https://github.com/typeorm/typeorm/releases" target="_blank" rel="nofollow noopener noreferrer">github.com/typeorm/typeorm/releases</a></p>
</blockquote>
<p>If you are an experienced Node.js developer and use the TypeORM library in your project, you must have encountered the problem of creating a virtual field in the data model. We need this field in order to be able to return an additional result in the response, but <strong>we don’t want to store it directly in the database</strong>.
What you are most likely looking for should be named <code class="language-text">.addSelectAndMap()</code>, <code class="language-text">@VirtualColumn()</code> or <code class="language-text">Computed Column</code> decorator.</p>
<hr>
<p>The creators of the library know very well about the existing problem. On 03/26/2018, @pleerock <a href="https://github.com/typeorm/typeorm/issues/1822#issuecomment-376069476" target="_blank" rel="nofollow noopener noreferrer">wrote</a> this comment:</p>
<blockquote>
<p>Official solution named addSelectAndMap will come into QueryBuilder in 0.3.0.</p>
</blockquote>
<p>Many people have asked the same question over the years.
You can read more here: <a href="https://github.com/typeorm/typeorm/issues/296" target="_blank" rel="nofollow noopener noreferrer">#296</a>, <a href="https://github.com/typeorm/typeorm/issues/1822" target="_blank" rel="nofollow noopener noreferrer">#1822</a>, <a href="https://github.com/typeorm/typeorm/issues/2498" target="_blank" rel="nofollow noopener noreferrer">#2498</a>, <a href="https://github.com/typeorm/typeorm/pull/4703" target="_blank" rel="nofollow noopener noreferrer">#4703</a>, <a href="https://github.com/typeorm/typeorm/pull/6855" target="_blank" rel="nofollow noopener noreferrer">#6855</a>, <a href="https://github.com/typeorm/typeorm/issues/7008" target="_blank" rel="nofollow noopener noreferrer">#7008</a>.</p>
<p>This issue has not been officially resolved so far.</p>
<hr>
<p>In this article, I will show you all possible ways to deal with this problem. 
I sorted them out from the most insufficient to the one which fully solves this issue.</p>
<p><em>For this article, I’m working with Nest.js framework and PostgreSQL. However, 
I am convinced that you will definitely be able to implement it in another Node.js framework, e.g. Express.js.</em></p>
<p><em>I have also <a href="https://github.com/pietrzakadrian/nestjs-typeorm-virtualcolumn" target="_blank" rel="nofollow noopener noreferrer">prepared a repository</a> on github for you, in case you have any problems or want to copy the code. (each branch is a single solution)</em></p>
<h2 id="1-non-selectable-column" style="position:relative;"><a href="#1-non-selectable-column" aria-label="1 non selectable column permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Non-selectable column</h2>
<p>The weakest solution to this problem is to create an additional field in the model with parameters that prevent SQL operations: <em>SELECT</em>, <em>INSERT</em>, <em>UPDATE</em>.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Column<span class="token punctuation">,</span> Entity<span class="token punctuation">,</span> PrimaryGeneratedColumn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"typeorm"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Entity</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"users"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserEntity</span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">PrimaryGeneratedColumn</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> firstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> lastName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> select<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> nullable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> insert<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> update<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> fullName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The column <strong>will not be included</strong> in the model until you use the <code class="language-text">.addSelect()</code> function.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/common"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserEntity <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../entities/user.entity"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserRepository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../repositories/user.repository"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> _userRepository<span class="token operator">:</span> UserRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>UserEntity <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_userRepository<span class="token punctuation">.</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    queryBuilder<span class="token punctuation">.</span><span class="token function">addSelect</span><span class="token punctuation">(</span>
      <span class="token string">"user.firstName || ' ' || user.lastName"</span><span class="token punctuation">,</span>
      <span class="token string">"user_fullName"</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> queryBuilder<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Your controller will run the following SQL query:</p>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"id"</span> <span class="token keyword">AS</span> <span class="token string">"user_id"</span><span class="token punctuation">,</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"firstName"</span> <span class="token keyword">AS</span> <span class="token string">"user_firstName"</span><span class="token punctuation">,</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"lastName"</span> <span class="token keyword">AS</span> <span class="token string">"user_lastName"</span><span class="token punctuation">,</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"firstName"</span> <span class="token operator">||</span> <span class="token string">' '</span> <span class="token operator">||</span> <span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"lastName"</span> <span class="token keyword">AS</span> <span class="token string">"user_fullName"</span>
<span class="token keyword">FROM</span>
	<span class="token string">"users"</span> <span class="token string">"user"</span></code></pre></div>
<p>And will return the following result in response:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"firstName"</span><span class="token operator">:</span> <span class="token string">"Adrian"</span><span class="token punctuation">,</span>
  <span class="token property">"lastName"</span><span class="token operator">:</span> <span class="token string">"Pietrzak"</span><span class="token punctuation">,</span>
  <span class="token property">"fullName"</span><span class="token operator">:</span> <span class="token string">"Adrian Pietrzak"</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This is fine but also has very big drawback: after compiling the code, it adds 
a new column in the database.</p>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token string">"public"</span><span class="token punctuation">.</span><span class="token string">"users"</span>
	<span class="token keyword">ADD</span> <span class="token string">"fullName"</span> <span class="token keyword">character</span> <span class="token keyword">varying</span></code></pre></div>
<p>This is not a correct solution. We should not create strange structures in the database to be able to correctly return the result of the SQL operation. ❌</p>
<blockquote>
<p>thank u, next</p>
</blockquote>
<h2 id="2-getrawmethod" style="position:relative;"><a href="#2-getrawmethod" aria-label="2 getrawmethod permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. getRaw() method</h2>
<p>Another, still inadequate, solution is to use the built-in <code class="language-text">.getRawOne()</code> or <code class="language-text">.getRawMany()</code> functions.</p>
<p>All you need to do is attach the <code class="language-text">.addSelect()</code> to the query and execute your business logic in it. The function <code class="language-text">.getRawOne()</code> will return the result that matches the executed SQL query.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/common"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserEntity <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../entities/user.entity"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserRepository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../repositories/user.repository"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> _userRepository<span class="token operator">:</span> UserRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>UserEntity <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_userRepository<span class="token punctuation">.</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    queryBuilder<span class="token punctuation">.</span><span class="token function">addSelect</span><span class="token punctuation">(</span>
      <span class="token string">"user.firstName || ' ' || user.lastName"</span><span class="token punctuation">,</span>
      <span class="token string">"user_fullName"</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> queryBuilder<span class="token punctuation">.</span><span class="token function">getRawOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The SQL query will be formulated as follows (same as above):</p>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"id"</span> <span class="token keyword">AS</span> <span class="token string">"user_id"</span><span class="token punctuation">,</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"firstName"</span> <span class="token keyword">AS</span> <span class="token string">"user_firstName"</span><span class="token punctuation">,</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"lastName"</span> <span class="token keyword">AS</span> <span class="token string">"user_lastName"</span><span class="token punctuation">,</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"firstName"</span> <span class="token operator">||</span> <span class="token string">' '</span> <span class="token operator">||</span> <span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"lastName"</span> <span class="token keyword">AS</span> <span class="token string">"user_fullName"</span>
<span class="token keyword">FROM</span>
	<span class="token string">"users"</span> <span class="token string">"user"</span></code></pre></div>
<p>And your json payload will look like this:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"user_firstName"</span><span class="token operator">:</span> <span class="token string">"Adrian"</span><span class="token punctuation">,</span>
  <span class="token property">"user_lastName"</span><span class="token operator">:</span> <span class="token string">"Pietrzak"</span><span class="token punctuation">,</span>
  <span class="token property">"user_fullName"</span><span class="token operator">:</span> <span class="token string">"Adrian Pietrzak"</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Formally, we have achieved the goal. Now we can add an extensive query to our model. Unfortunately, as you may have noticed, the <code class="language-text">.getRawOne()</code> function does not return the mapped object. Now the output may not match the Swagger documentation and this causes additional problems.
Also unacceptable solution. ❌</p>
<h2 id="3-subscriber-method" style="position:relative;"><a href="#3-subscriber-method" aria-label="3 subscriber method permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Subscriber method</h2>
<p>This solution is most often chosen by developers. It uses the subscriber <code class="language-text">@AfterLoad()</code> to append each time the given result to the loaded model. Let’s look at prepared code:</p>
<p>First, create an additional variable (not a column) in your model:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Column<span class="token punctuation">,</span> Entity<span class="token punctuation">,</span> PrimaryGeneratedColumn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"typeorm"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Entity</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"users"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserEntity</span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">PrimaryGeneratedColumn</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> firstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> lastName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> fullName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Next, create a Subscriber class that will perform the intended action. Remember to load it in the appropriate place in the source code:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> EntitySubscriberInterface<span class="token punctuation">,</span> EventSubscriber <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"typeorm"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserEntity <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../entities/user.entity"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">EventSubscriber</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserSubscriber</span> <span class="token keyword">implements</span> <span class="token class-name">EntitySubscriberInterface<span class="token operator">&lt;</span>UserEntity<span class="token operator">></span></span> <span class="token punctuation">{</span>
  <span class="token function">listenTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> UserEntity<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">afterLoad</span><span class="token punctuation">(</span>user<span class="token operator">:</span> UserEntity<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>
    user<span class="token punctuation">.</span>fullName <span class="token operator">=</span> user<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>lastName<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/common"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigModule<span class="token punctuation">,</span> ConfigService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/config"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> TypeOrmModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/typeorm"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserSubscriber <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"src/user/subscribers/user.subscriber"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    TypeOrmModule<span class="token punctuation">.</span><span class="token function">forRootAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
      inject<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigService<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token punctuation">(</span>configService<span class="token operator">:</span> ConfigService<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">"postgres"</span><span class="token punctuation">,</span>
        host<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"POSTGRES_HOST"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        port<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"POSTGRES_PORT"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        username<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"POSTGRES_USERNAME"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        password<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"POSTGRES_PASSWORD"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        database<span class="token operator">:</span> configService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"POSTGRES_DB_NAME"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        entities<span class="token operator">:</span> <span class="token punctuation">[</span>__dirname <span class="token operator">+</span> <span class="token string">"/../**/*.entity.{js,ts}"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        synchronize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        logging<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        subscribers<span class="token operator">:</span> <span class="token punctuation">[</span>UserSubscriber<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">DatabaseModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<p>Our user service remains unchanged:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/common"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserEntity <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../entities/user.entity"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserRepository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../repositories/user.repository"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> _userRepository<span class="token operator">:</span> UserRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>UserEntity <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_userRepository<span class="token punctuation">.</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> queryBuilder<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now the controller will execute the following SQL query:</p>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"id"</span> <span class="token keyword">AS</span> <span class="token string">"user_id"</span><span class="token punctuation">,</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"firstName"</span> <span class="token keyword">AS</span> <span class="token string">"user_firstName"</span><span class="token punctuation">,</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"lastName"</span> <span class="token keyword">AS</span> <span class="token string">"user_lastName"</span>
<span class="token keyword">FROM</span>
	<span class="token string">"users"</span> <span class="token string">"user"</span></code></pre></div>
<p>But before returning the response, it append code to the output that subscriber executes:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"firstName"</span><span class="token operator">:</span> <span class="token string">"Adrian"</span><span class="token punctuation">,</span>
  <span class="token property">"lastName"</span><span class="token operator">:</span> <span class="token string">"Pietrzak"</span><span class="token punctuation">,</span>
  <span class="token property">"fullName"</span><span class="token operator">:</span> <span class="token string">"Adrian Pietrzak"</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Many programmers could now consider the solution to be correct. <strong>Not exactly.</strong> As I wrote earlier, your business logic will now <strong>be executed every time you try to load entity</strong>. Also when using the <code class="language-text">.innerJoinAndSelect()</code> function! If you now return 25 users simultaneously, your code with the virtual field will be executed 25 times.</p>
<p>You don’t always need to include your complicated calculations. By using the event listener, you have no control over it.</p>
<p>Better than before, but still not perfect. ❌</p>
<h2 id="4-loadrelationcountandmap-method" style="position:relative;"><a href="#4-loadrelationcountandmap-method" aria-label="4 loadrelationcountandmap method permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. loadRelationCountAndMap() method</h2>
<p>If you only need to pass count tightly nested relationship, you can use the built-in <code class="language-text">.loadRelationCountAndMap()</code> function.
This allows for an extensive query.</p>
<p>The syntax looks like this:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>UserEntity<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_userRepository<span class="token punctuation">.</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    queryBuilder
       <span class="token punctuation">.</span><span class="token function">loadRelationCountAndMap</span><span class="token punctuation">(</span>
         <span class="token string">"images"</span><span class="token punctuation">,</span>
         qb <span class="token operator">=></span> qb<span class="token punctuation">.</span><span class="token function">andWhere</span><span class="token punctuation">(</span><span class="token string">"images.isRemoved = :isRemoved"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> isRemoved<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> queryBuilder<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This is a very good solution. It will always return a number, but you can also use it as boolean data. ✅</p>
<h2 id="5-decorator-method" style="position:relative;"><a href="#5-decorator-method" aria-label="5 decorator method permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5. Decorator method</h2>
<p>It would be ideal if we had a built-in <code class="language-text">@VirtualColumn()</code> decorator that we declare in our model and when we use <code class="language-text">.addSelect()</code> the result will be assigned to that key. So let’s just program it.</p>
<p>Let’s start by creating a decorator:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token string">"reflect-metadata"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">VIRTUAL_COLUMN_KEY</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"VIRTUAL_COLUMN_KEY"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">VirtualColumn</span><span class="token punctuation">(</span>name<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> PropertyDecorator <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> propertyKey<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> metaInfo <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token constant">VIRTUAL_COLUMN_KEY</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    metaInfo<span class="token punctuation">[</span>propertyKey<span class="token punctuation">]</span> <span class="token operator">=</span> name <span class="token operator">??</span> propertyKey<span class="token punctuation">;</span>

    Reflect<span class="token punctuation">.</span><span class="token function">defineMetadata</span><span class="token punctuation">(</span><span class="token constant">VIRTUAL_COLUMN_KEY</span><span class="token punctuation">,</span> metaInfo<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now we can import it into our entity and assign it to a new field:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> VirtualColumn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"src/database/decorators/virtual-column.decorator"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Column<span class="token punctuation">,</span> Entity<span class="token punctuation">,</span> PrimaryGeneratedColumn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"typeorm"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Entity</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"users"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserEntity</span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">PrimaryGeneratedColumn</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> firstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> lastName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">VirtualColumn</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> fullName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now we need to override the core TypeORM functions <code class="language-text">.getOne()</code> and <code class="language-text">.getMany()</code>. <strong>No worries!</strong> We won’t break it. We will add a few lines of code that our decorator will understand.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">VIRTUAL_COLUMN_KEY</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"src/database/decorators/virtual-column.decorator"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SelectQueryBuilder <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"typeorm"</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">"typeorm"</span> <span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">SelectQueryBuilder<span class="token operator">&lt;</span>Entity<span class="token operator">></span></span> <span class="token punctuation">{</span>
    <span class="token function">getMany</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> SelectQueryBuilder<span class="token operator">&lt;</span>Entity<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Entity<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token function">getOne</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> SelectQueryBuilder<span class="token operator">&lt;</span>Entity<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Entity <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

SelectQueryBuilder<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getMany</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> entities<span class="token punctuation">,</span> raw <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRawAndEntities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> items <span class="token operator">=</span> entities<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>entitiy<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> metaInfo <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token constant">VIRTUAL_COLUMN_KEY</span><span class="token punctuation">,</span> entitiy<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> item <span class="token operator">=</span> raw<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>propertyKey<span class="token punctuation">,</span> name<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">entries</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>metaInfo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      entitiy<span class="token punctuation">[</span>propertyKey<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> entitiy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>items<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

SelectQueryBuilder<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getOne</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> entities<span class="token punctuation">,</span> raw <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRawAndEntities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> metaInfo <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token constant">VIRTUAL_COLUMN_KEY</span><span class="token punctuation">,</span> entities<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>propertyKey<span class="token punctuation">,</span> name<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">entries</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>metaInfo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    entities<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>propertyKey<span class="token punctuation">]</span> <span class="token operator">=</span> raw<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> entities<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>You need to implement our code in the right place for it to be compiled:</p>
<div class="gatsby-highlight" data-language="diff"><pre class="language-diff"><code class="language-diff">import * as Joi from '@hapi/joi';
import { Module } from '@nestjs/common';
import { ConfigModule } from '@nestjs/config';
import { UserModule } from 'src/user/user.module';
import { DatabaseModule } from '../database/database.module';
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> import './polyfill';
</span>
@Module({
<span class="token unchanged"><span class="token prefix unchanged"> </span> imports: [
<span class="token prefix unchanged"> </span>   ConfigModule.forRoot({
<span class="token prefix unchanged"> </span>     validationSchema: Joi.object({
<span class="token prefix unchanged"> </span>       POSTGRES_HOST: Joi.string().required(),
<span class="token prefix unchanged"> </span>       POSTGRES_PORT: Joi.number().required(),
<span class="token prefix unchanged"> </span>       POSTGRES_USERNAME: Joi.string().required(),
<span class="token prefix unchanged"> </span>       POSTGRES_PASSWORD: Joi.string().allow(''),
<span class="token prefix unchanged"> </span>       POSTGRES_DB_NAME: Joi.string().required(),
<span class="token prefix unchanged"> </span>     }),
<span class="token prefix unchanged"> </span>   }),
<span class="token prefix unchanged"> </span>   DatabaseModule,
<span class="token prefix unchanged"> </span>   UserModule,
<span class="token prefix unchanged"> </span> ],
<span class="token prefix unchanged"> </span> controllers: [],
<span class="token prefix unchanged"> </span> providers: [],
</span>})
export class AppModule {}
</code></pre></div>
<p>I extended the user service, added an additional method to it that returns multiple users, and added the <code class="language-text">.addSelect()</code> function:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/common"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserEntity <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../entities/user.entity"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserRepository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../repositories/user.repository"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> _userRepository<span class="token operator">:</span> UserRepository<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>UserEntity<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_userRepository<span class="token punctuation">.</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    queryBuilder<span class="token punctuation">.</span><span class="token function">addSelect</span><span class="token punctuation">(</span>
      <span class="token string">"user.firstName || ' ' || user.lastName"</span><span class="token punctuation">,</span>
      <span class="token string">"fullName"</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> queryBuilder<span class="token punctuation">.</span><span class="token function">getMany</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>UserEntity <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> queryBuilder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_userRepository<span class="token punctuation">.</span><span class="token function">createQueryBuilder</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    queryBuilder<span class="token punctuation">.</span><span class="token function">addSelect</span><span class="token punctuation">(</span>
      <span class="token string">"user.firstName || ' ' || user.lastName"</span><span class="token punctuation">,</span>
      <span class="token string">"fullName"</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> queryBuilder<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>I created an additional controller to run my functions:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Controller<span class="token punctuation">,</span> Get <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@nestjs/common"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserEntity <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../entities/user.entity"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../services/user.service"</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">"Users"</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> _userService<span class="token operator">:</span> UserService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">"many"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>UserEntity<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_userService<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>UserEntity <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_userService<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now, when I add the <code class="language-text">.addSelect()</code> and assign the result to the virtual column name, the app will perform the following SQL operation:</p>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"id"</span> <span class="token keyword">AS</span> <span class="token string">"user_id"</span><span class="token punctuation">,</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"firstName"</span> <span class="token keyword">AS</span> <span class="token string">"user_firstName"</span><span class="token punctuation">,</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"lastName"</span> <span class="token keyword">AS</span> <span class="token string">"user_lastName"</span><span class="token punctuation">,</span>
	<span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"firstName"</span> <span class="token operator">||</span> <span class="token string">' '</span> <span class="token operator">||</span> <span class="token string">"user"</span><span class="token punctuation">.</span><span class="token string">"lastName"</span> <span class="token keyword">AS</span> <span class="token string">"fullName"</span>
<span class="token keyword">FROM</span>
	<span class="token string">"users"</span> <span class="token string">"user"</span></code></pre></div>
<p>And it will return the mapped model for the <code class="language-text">.getOne()</code> and <code class="language-text">.getMany()</code> functions, as you always wanted. 🎉</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"firstName"</span><span class="token operator">:</span> <span class="token string">"Adrian"</span><span class="token punctuation">,</span>
  <span class="token property">"lastName"</span><span class="token operator">:</span> <span class="token string">"Pietrzak"</span><span class="token punctuation">,</span>
  <span class="token property">"fullName"</span><span class="token operator">:</span> <span class="token string">"Adrian Pietrzak"</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"firstName"</span><span class="token operator">:</span> <span class="token string">"Adrian"</span><span class="token punctuation">,</span>
    <span class="token property">"lastName"</span><span class="token operator">:</span> <span class="token string">"Pietrzak"</span><span class="token punctuation">,</span>
    <span class="token property">"fullName"</span><span class="token operator">:</span> <span class="token string">"Adrian Pietrzak"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">"firstName"</span><span class="token operator">:</span> <span class="token string">"Adrian"</span><span class="token punctuation">,</span>
    <span class="token property">"lastName"</span><span class="token operator">:</span> <span class="token string">"Mydłowski"</span><span class="token punctuation">,</span>
    <span class="token property">"fullName"</span><span class="token operator">:</span> <span class="token string">"Adrian Mydłowski"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">"firstName"</span><span class="token operator">:</span> <span class="token string">"Mateusz"</span><span class="token punctuation">,</span>
    <span class="token property">"lastName"</span><span class="token operator">:</span> <span class="token string">"Polski"</span><span class="token punctuation">,</span>
    <span class="token property">"fullName"</span><span class="token operator">:</span> <span class="token string">"Mateusz Polski"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre></div>
<p>Now we are able to attach any query to our model without any problems,
<strong>as you’ve always wanted</strong>. ✅</p>
<hr>
<p>You can also find this article on <a href="https://medium.com/@pietrzakadrian" target="_blank" rel="nofollow noopener noreferrer">medium.com</a> where I share my solutions to the problems I encountered during my software engineer career.</p></div></div></div><div><div class="Copyright-module--copyright--766ee">© All rights reserved.</div></div><div class="Post-module--footer--f8705"><div class="Tags-module--tags--18589"><ul class="Tags-module--list--82ae6"><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/typescript/">TypeScript</a></li><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/nodejs/">NodeJS</a></li><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/typeorm/">TypeORM</a></li><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/nestjs/">NestJS</a></li></ul></div></div><div class="Post-module--comments--d3b99"><div></div></div><hr/><div><h2>Related articles</h2><section class="Related-module--related--75a7f"><div class="Feed-module--feed--a6204"><div class="Feed-module--item--c7a63"><div class="Feed-module--meta--250c2"><time class="Feed-module--time--72864" dateTime="February 13, 2022">February 13, 2022</time><span class="Feed-module--divider--81a18">—</span><small>21<!-- --> min read</small></div><h2 class="Feed-module--title--f252f"><a class="Feed-module--link--6123b" href="/blog/nestjs-authentication-series/user-registration">NestJS Authentication Series 🔐: Part 1 - User registration</a></h2><p class="Feed-module--description--57348">Welcome you to my blog series on user authentication in the NestJS framework. This series is a set of several tutorials that extend the official documentation. If you are programming an enterprise application, you will most likely want to include full user support, i.e. email account confirmation, password reminder capability, etc. This post is the first part in a series and below you can find a list of all the other articles on this topic.</p><div class="Feed-module--bottom--dd480"><div class="Feed-module--tags--75a26"><div class="Tags-module--tags--18589"><ul class="Tags-module--list--82ae6"><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/typescript/">TypeScript</a></li><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/nodejs/">NodeJS</a></li><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/nestjs/">NestJS</a></li></ul></div></div></div></div><div class="Feed-module--item--c7a63"><div class="Feed-module--meta--250c2"><time class="Feed-module--time--72864" dateTime="December 1, 2021">December 1, 2021</time><span class="Feed-module--divider--81a18">—</span><small>11<!-- --> min read</small></div><h2 class="Feed-module--title--f252f"><a class="Feed-module--link--6123b" href="/blog/how-to-create-a-microservice-that-handles-the-queue-of-sending-emails-in-nestjs">How to create a microservice that handles 🎢 the queue of sending emails in NestJS</a></h2><p class="Feed-module--description--57348">In this article, I will present you independent microservice that handles the queue of sending emails using the Node.js platform with the NestJS framework. The use of this microservice allows you to decouple the business logic of the email senders from the main monolithic application, resulting in less use of server resources and therefore faster source code execution.</p><div class="Feed-module--bottom--dd480"><div class="Feed-module--tags--75a26"><div class="Tags-module--tags--18589"><ul class="Tags-module--list--82ae6"><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/nodejs/">NodeJS</a></li><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/typescript/">TypeScript</a></li><li class="Tags-module--item--52015"><a class="Button-module--button--b1113 Tags-module--button--421f7" href="/blog/tag/nestjs/">NestJS</a></li></ul></div></div></div></div></div></section></div></div></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/virtual-column-solutions-for-typeorm";window.___webpackCompilationHash="9196ec8ec5d1abe9fabb";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-cab95f7e201ad758988f.js"],"app":["/app-e99dd9c7f504093f512a.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-0c915c7b1bdb5eac4fdf.js"],"component---src-templates-blog-template-blog-template-tsx":["/component---src-templates-blog-template-blog-template-tsx-58bc8ceaed49b6bc6e96.js"],"component---src-templates-categories-template-categories-template-tsx":["/component---src-templates-categories-template-categories-template-tsx-e95e61bcac46a2493a97.js"],"component---src-templates-category-template-category-template-tsx":["/component---src-templates-category-template-category-template-tsx-28bfdccebef64c7a1a33.js"],"component---src-templates-certifications-template-certifications-template-tsx":["/component---src-templates-certifications-template-certifications-template-tsx-576c0e955466ae0e83b2.js"],"component---src-templates-collaboration-template-collaboration-template-tsx":["/component---src-templates-collaboration-template-collaboration-template-tsx-e730d234ae5ced168a8b.js"],"component---src-templates-home-template-home-template-tsx":["/component---src-templates-home-template-home-template-tsx-7a400f1de4d0f09c8628.js"],"component---src-templates-not-found-template-not-found-template-tsx":["/component---src-templates-not-found-template-not-found-template-tsx-ea68c7ff6de6afaebced.js"],"component---src-templates-page-template-page-template-tsx":["/component---src-templates-page-template-page-template-tsx-f4339b4ae2b8c66ab1fa.js"],"component---src-templates-post-template-post-template-tsx":["/component---src-templates-post-template-post-template-tsx-ee787588b7eee7fcc21c.js"],"component---src-templates-tag-template-tag-template-tsx":["/component---src-templates-tag-template-tag-template-tsx-5d805ab8a8401972f01a.js"],"component---src-templates-tags-template-tags-template-tsx":["/component---src-templates-tags-template-tags-template-tsx-68309a9b42b11997ffc7.js"]};/*]]>*/</script><script src="/polyfill-cab95f7e201ad758988f.js" nomodule=""></script><script src="/app-e99dd9c7f504093f512a.js" async=""></script><script src="/framework-745d5d28c0250a1a333b.js" async=""></script><script src="/webpack-runtime-13d9b3b7e4ebac5bf994.js" async=""></script></body></html>